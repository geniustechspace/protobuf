// DOMAIN: Multitenancy - Tenant Entity
// COMPLIANCE: SOC 2 CC6.1 (Logical Access), ISO 27001 A.9.1, GDPR Article 5
// SECURITY: Core tenant isolation and management
// DDD: Aggregate Root - controls tenant lifecycle and configuration
// PURPOSE: Decoupled tenant management enabling easy switching of isolation modes

syntax = "proto3";

package geniustechspace.multitenancy.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Multitenancy.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/multitenancy/v1;multitenancyv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.multitenancy.v1";

// Tenant aggregate root - represents a tenant in the system.
// ISOLATION: Tenants are the top-level isolation boundary.
// HIERARCHY: Supports nested tenant hierarchies for B2B2B scenarios.
// INVARIANTS:
// - Tenant slug unique globally
// - Parent tenant must exist if parent_id is specified
// - System tenants cannot be deleted
// - Isolation mode cannot change after creation (requires migration)
message Tenant {
  // Tenant ID. Immutable unique identifier.
  // FORMAT: UUID v4 or ULID
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Human-readable unique slug. Immutable after creation.
  // Used in URLs, APIs, and hierarchical paths.
  // FORMAT: lowercase alphanumeric with hyphens
  // Examples: "acme-corp", "customer-1"
  string slug = 2 [(buf.validate.field).string = {
    min_len: 3
    max_len: 63
    pattern: "^[a-z][a-z0-9-]*[a-z0-9]$"
  }];

  // Display name (human-readable, may include spaces/special chars).
  string display_name = 3 [(buf.validate.field).string.max_len = 255];

  // Tenant description.
  string description = 4 [(buf.validate.field).string.max_len = 1000];

  // Tenant type classification.
  TenantType type = 5 [(buf.validate.field).enum.defined_only = true];

  // Tenant lifecycle status.
  TenantStatus status = 6 [(buf.validate.field).enum.defined_only = true];

  // Parent tenant ID for hierarchical multi-tenancy.
  // NULL for root/top-level tenants.
  // Enables B2B2B, reseller, and white-label scenarios.
  string parent_id = 7;

  // Hierarchical tenant path. Computed from parent chain.
  // FORMAT: "root-tenant/child-tenant/grandchild-tenant"
  // IMMUTABLE: Changes require tenant migration.
  // Examples: "acme-corp", "acme-corp/customer-1", "acme-corp/customer-1/sub-org"
  string path = 8 [(buf.validate.field).string.max_len = 512];

  // Depth level in tenant hierarchy (0 = root).
  int32 depth = 9 [(buf.validate.field).int32 = {
    gte: 0
    lte: 10
  }];

  // Isolation mode. IMMUTABLE after creation.
  // Determines data storage and access patterns.
  TenantIsolationMode isolation_mode = 10 [(buf.validate.field).enum.defined_only = true];

  // Tenant settings and configuration.
  TenantSettings settings = 11;

  // Child tenant IDs for hierarchy navigation.
  repeated string child_tenant_ids = 12;

  // Feature flags enabled for this tenant.
  repeated string feature_flags = 13;

  // Subscription/plan tier (free, starter, professional, enterprise).
  string plan_tier = 14;

  // Custom metadata for extensibility.
  map<string, string> metadata = 15;

  // System tenant flag - platform-managed, cannot be deleted.
  bool is_system = 16;

  // Created timestamp. IMMUTABLE after creation.
  // COMPLIANCE: SOC 2 CC6.3, GDPR Article 30 (audit trail)
  google.protobuf.Timestamp created_at = 17 [(buf.validate.field).required = true];

  // Last updated timestamp.
  // COMPLIANCE: SOC 2 CC6.3 (change tracking)
  google.protobuf.Timestamp updated_at = 18;

  // Deletion timestamp. If set, entity is soft deleted.
  // COMPLIANCE: GDPR Article 17, SOC 2 CC6.3 (deletion audit trail)
  google.protobuf.Timestamp deleted_at = 19;

  // Optimistic locking version counter.
  // COMPLIANCE: SOC 2 CC6.1 (data integrity)
  int64 version = 20;
}

// TenantType - classification of tenants.
enum TenantType {
  // Unspecified - invalid default value.
  TENANT_TYPE_UNSPECIFIED = 0;

  // Platform tenant - the system operator/provider.
  PLATFORM = 1;

  // Organization tenant - standard customer organization.
  ORGANIZATION = 2;

  // Reseller tenant - partner who manages sub-tenants.
  RESELLER = 3;

  // White-label tenant - branded sub-platform.
  WHITE_LABEL = 4;

  // Sandbox tenant - testing/trial environment.
  SANDBOX = 5;

  // Internal tenant - for internal operations.
  INTERNAL = 6;
}

// TenantStatus - tenant lifecycle states.
// STATE TRANSITIONS:
// - PENDING -> ACTIVE (provisioning completed)
// - ACTIVE <-> SUSPENDED (admin action, policy violation)
// - ACTIVE <-> INACTIVE (admin action)
// - ANY -> DELETED (soft delete)
enum TenantStatus {
  // Unspecified - invalid default value.
  TENANT_STATUS_UNSPECIFIED = 0;

  // Active tenant - fully operational.
  ACTIVE = 1;

  // Inactive - temporarily disabled, can be reactivated.
  INACTIVE = 2;

  // Suspended - admin action or policy violation.
  SUSPENDED = 3;

  // Deleted - soft delete, data retained for audit.
  DELETED = 4;

  // Pending - initial state, provisioning in progress.
  PENDING = 5;

  // Trial - trial period, limited features.
  TRIAL = 6;

  // Expired - trial or subscription expired.
  EXPIRED = 7;
}

// TenantIsolationMode - data isolation strategy.
// IMMUTABLE: Cannot be changed after tenant creation.
// Determines database schema and data access patterns.
enum TenantIsolationMode {
  // Unspecified - invalid default value.
  TENANT_ISOLATION_MODE_UNSPECIFIED = 0;

  // Shared schema - all tenants share tables with tenant_id column.
  // PERFORMANCE: Most efficient for high tenant counts.
  // ISOLATION: Logical isolation via row-level security.
  SHARED = 1;

  // Silo schema - each tenant has own database/schema.
  // ISOLATION: Strongest isolation, physical separation.
  // COMPLIANCE: Required for some regulated industries.
  SILO = 2;

  // Hybrid - shared operational data, isolated sensitive data.
  // BALANCE: Combines performance with compliance requirements.
  HYBRID = 3;

  // Pool - tenant groups share schemas (multi-pool).
  // SCALING: Horizontal scaling with bounded tenant counts per pool.
  POOL = 4;
}

// TenantSettings - tenant configuration and limits.
message TenantSettings {
  // Maximum users allowed in this tenant.
  int32 max_users = 1;

  // Maximum groups allowed in this tenant.
  int32 max_groups = 2;

  // Maximum child tenants allowed.
  int32 max_child_tenants = 3;

  // Storage quota in bytes.
  int64 storage_quota_bytes = 4;

  // API rate limit (requests per minute).
  int32 api_rate_limit = 5;

  // Session timeout in seconds.
  int32 session_timeout_seconds = 6;

  // MFA requirement policy.
  MfaPolicy mfa_policy = 7;

  // Password policy configuration.
  PasswordPolicy password_policy = 8;

  // Allowed authentication methods.
  repeated string allowed_auth_methods = 9;

  // Allowed identity providers for federation.
  repeated string allowed_identity_providers = 10;

  // Custom branding configuration.
  TenantBranding branding = 11;

  // Data residency region.
  string data_residency_region = 12;

  // Enable audit logging.
  bool audit_logging_enabled = 13;
}

// MfaPolicy - multi-factor authentication requirements.
enum MfaPolicy {
  // Unspecified - invalid default value.
  MFA_POLICY_UNSPECIFIED = 0;

  // MFA not required.
  DISABLED = 1;

  // MFA optional, user choice.
  OPTIONAL = 2;

  // MFA required for all users.
  REQUIRED = 3;

  // MFA required for privileged roles only.
  REQUIRED_FOR_PRIVILEGED = 4;
}

// PasswordPolicy - password requirements.
message PasswordPolicy {
  // Minimum password length.
  int32 min_length = 1;

  // Require uppercase characters.
  bool require_uppercase = 2;

  // Require lowercase characters.
  bool require_lowercase = 3;

  // Require numeric characters.
  bool require_numbers = 4;

  // Require special characters.
  bool require_special = 5;

  // Password expiry in days (0 = never expires).
  int32 expiry_days = 6;

  // Password history count (prevent reuse).
  int32 history_count = 7;

  // Maximum consecutive failed attempts before lockout.
  int32 max_failed_attempts = 8;

  // Lockout duration in seconds.
  int32 lockout_duration_seconds = 9;
}

// TenantBranding - visual customization.
message TenantBranding {
  // Logo URL.
  string logo_url = 1;

  // Favicon URL.
  string favicon_url = 2;

  // Primary brand color (hex format).
  string primary_color = 3;

  // Secondary brand color (hex format).
  string secondary_color = 4;

  // Custom CSS URL.
  string custom_css_url = 5;

  // Custom email template prefix.
  string email_template_prefix = 6;

  // Support email address.
  string support_email = 7;

  // Support URL.
  string support_url = 8;
}
