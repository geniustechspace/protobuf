// Copyright 2024 GeniusTechSpace
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// UserService gRPC Service Definition
//
// This file defines the UserService which provides comprehensive user
// management operations including CRUD operations, authentication,
// and status management within a multi-tenant architecture.
//
// COMPLIANCE:
// - SOC 2 CC6.1: Logical and physical access controls
// - ISO 27001 A.9.2: User access management
// - GDPR Article 5: Lawfulness, fairness and transparency
// - GDPR Article 32: Security of processing
// - HIPAA 164.312(a)(1): Access control (when handling PHI)
//
// AUTHENTICATION:
// - All RPCs require valid authentication token in metadata
// - Token validated before processing any request
// - Expired tokens rejected with UNAUTHENTICATED error
//
// AUTHORIZATION:
// - User must have appropriate role/permission for operation
// - Tenant isolation enforced - users can only access own tenant data
// - Create/Delete operations require admin role
// - Update operations require admin role or self-service permission
//
// AUDIT:
// - All operations logged with actor, timestamp, and details
// - Failed authorization attempts logged for security monitoring
// - Successful operations publish domain events
//
// RATE LIMITING:
// - Create operations: 10 per minute per tenant
// - Update operations: 60 per minute per user
// - List operations: 30 per minute per user
// - Password changes: 5 per hour per user
//
// ERROR HANDLING:
// - INVALID_ARGUMENT: Validation failure (e.g., invalid email)
// - ALREADY_EXISTS: Username/email already exists in tenant
// - NOT_FOUND: User ID not found in tenant
// - PERMISSION_DENIED: Insufficient permissions or wrong tenant
// - UNAUTHENTICATED: Missing or invalid authentication token
// - RESOURCE_EXHAUSTED: Rate limit exceeded

syntax = "proto3";

package users.v1;

import "users/v1/messages/create_user_request.proto";
import "users/v1/messages/create_user_response.proto";
import "users/v1/messages/get_user_request.proto";
import "users/v1/messages/get_user_response.proto";
import "users/v1/messages/update_user_request.proto";
import "users/v1/messages/update_user_response.proto";
import "users/v1/messages/delete_user_request.proto";
import "users/v1/messages/delete_user_response.proto";
import "users/v1/messages/list_users_request.proto";
import "users/v1/messages/list_users_response.proto";
import "users/v1/messages/change_password_request.proto";
import "users/v1/messages/change_password_response.proto";
import "users/v1/messages/update_user_status_request.proto";
import "users/v1/messages/update_user_status_response.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Users.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/users/v1;usersv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.users.v1";

// UserService provides comprehensive user management operations.
//
// This service handles all user-related operations including creation,
// retrieval, updates, deletion, and status management. All operations
// enforce multi-tenant isolation and require appropriate authentication
// and authorization.
//
// SERVICE LEVEL AGREEMENT (SLA):
// - Availability: 99.9% uptime
// - Latency: p50 < 100ms, p95 < 500ms, p99 < 1000ms
// - Error Rate: < 0.1% for valid requests
//
// COMPLIANCE CERTIFICATIONS:
// - SOC 2 Type II compliant
// - ISO 27001 certified
// - GDPR compliant (EU data residency available)
// - HIPAA compliant configuration available
//
// MONITORING:
// - All operations emit metrics (success/failure rates, latency)
// - Distributed tracing enabled (correlation IDs)
// - Structured logging with tenant/user context
// - Alerting on error rate thresholds
service UserService {
  // CreateUser creates a new user within the specified tenant.
  //
  // Creates a new user account with the provided information. The email
  // and username must be unique within the tenant. A verification email
  // is sent to the provided address.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:create' permission or 'admin' role
  //
  // VALIDATION:
  // - tenant_id: Must be non-empty
  // - email: Must be valid email format, unique in tenant
  // - username: 3-50 characters, alphanumeric + underscore/hyphen
  // - password: Minimum 8 characters
  // - first_name, last_name: 1-100 characters
  //
  // EVENTS PUBLISHED:
  // - UserCreatedEvent: On successful creation
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Validation failure
  // - ALREADY_EXISTS: Email or username already exists
  // - PERMISSION_DENIED: Insufficient permissions
  // - UNAUTHENTICATED: Missing or invalid token
  // - RESOURCE_EXHAUSTED: Rate limit exceeded (10/min)
  //
  // COMPLIANCE:
  // - GDPR Article 6: Lawful basis for processing
  // - SOC 2 CC6.1: User provisioning controls
  //
  // EXAMPLE:
  //   CreateUserRequest request = CreateUserRequest.newBuilder()
  //       .setTenantId("tenant_123")
  //       .setEmail("user@example.com")
  //       .setUsername("johndoe")
  //       .setPassword("SecurePass123!")
  //       .setFirstName("John")
  //       .setLastName("Doe")
  //       .build();
  //   CreateUserResponse response = userService.createUser(request);
  rpc CreateUser(users.v1.CreateUserRequest) returns (users.v1.CreateUserResponse);

  // GetUser retrieves a user by ID within the specified tenant.
  //
  // Returns complete user information including profile, preferences,
  // and current status. Only returns users within the requesting user's
  // tenant for security.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:read' permission or self-access
  //
  // VALIDATION:
  // - tenant_id: Must be non-empty
  // - user_id: Must be valid UUID format
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Invalid UUID format
  // - NOT_FOUND: User not found in tenant
  // - PERMISSION_DENIED: Cannot access user in different tenant
  // - UNAUTHENTICATED: Missing or invalid token
  //
  // COMPLIANCE:
  // - GDPR Article 15: Right of access
  // - SOC 2 CC6.1: Access control verification
  //
  // CACHING:
  // - Response cached for 60 seconds
  // - Cache invalidated on user updates
  //
  // EXAMPLE:
  //   GetUserRequest request = GetUserRequest.newBuilder()
  //       .setTenantId("tenant_123")
  //       .setUserId("user_456")
  //       .build();
  //   GetUserResponse response = userService.getUser(request);
  rpc GetUser(users.v1.GetUserRequest) returns (users.v1.GetUserResponse);

  // UpdateUser updates an existing user's information.
  //
  // Updates user profile information. Only provided fields are updated
  // (partial update). Email and username must remain unique within tenant
  // if changed.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:update' permission, admin role, or self-update
  //
  // VALIDATION:
  // - Same validation rules as CreateUser for provided fields
  // - At least one field must be provided for update
  //
  // EVENTS PUBLISHED:
  // - UserUpdatedEvent: On successful update (includes changed fields)
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Validation failure
  // - NOT_FOUND: User not found
  // - ALREADY_EXISTS: Email/username conflicts with existing user
  // - PERMISSION_DENIED: Insufficient permissions
  // - RESOURCE_EXHAUSTED: Rate limit exceeded (60/min per user)
  //
  // COMPLIANCE:
  // - GDPR Article 16: Right to rectification
  // - SOC 2 CC6.1: User modification controls
  //
  // OPTIMISTIC LOCKING:
  // - Uses metadata.version for conflict detection
  // - Returns ABORTED if version mismatch (concurrent modification)
  rpc UpdateUser(users.v1.UpdateUserRequest) returns (users.v1.UpdateUserResponse);

  // DeleteUser soft-deletes a user account.
  //
  // Marks user as deleted without permanently removing data. User cannot
  // authenticate after deletion. Implements GDPR right to erasure with
  // retention period.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:delete' permission or 'admin' role
  //
  // VALIDATION:
  // - tenant_id: Must be non-empty
  // - user_id: Must exist in tenant
  //
  // EVENTS PUBLISHED:
  // - UserDeletedEvent: On successful deletion
  //
  // DATA RETENTION:
  // - Soft delete: Data retained for 90 days (configurable)
  // - Hard delete: Permanent removal after retention period
  // - GDPR compliance: Can expedite deletion on request
  //
  // ERRORS:
  // - NOT_FOUND: User not found
  // - PERMISSION_DENIED: Cannot delete users in different tenant
  // - FAILED_PRECONDITION: User is last admin in tenant
  //
  // COMPLIANCE:
  // - GDPR Article 17: Right to erasure
  // - SOC 2 CC6.2: User de-provisioning
  rpc DeleteUser(users.v1.DeleteUserRequest) returns (users.v1.DeleteUserResponse);

  // ListUsers retrieves a paginated list of users in a tenant.
  //
  // Returns users matching the specified filters with pagination support.
  // Results sorted by creation date (newest first) by default.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:list' permission
  //
  // PAGINATION:
  // - Default page_size: 20
  // - Maximum page_size: 100
  // - Returns pagination metadata for navigation
  //
  // FILTERING:
  // - status: Filter by user status
  // - roles: Filter by assigned roles
  // - search_query: Search in email, username, name
  //
  // PERFORMANCE:
  // - Indexed queries for optimal performance
  // - Response time: p95 < 200ms for default page_size
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Invalid pagination or filter parameters
  // - PERMISSION_DENIED: Insufficient permissions
  // - RESOURCE_EXHAUSTED: Rate limit (30/min per user)
  rpc ListUsers(users.v1.ListUsersRequest) returns (users.v1.ListUsersResponse);

  // ChangePassword changes a user's password.
  //
  // Validates current password and updates to new password. Password
  // is hashed with bcrypt (cost factor 12) before storage.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Self-service only (users can only change own password)
  //
  // VALIDATION:
  // - current_password: Must match stored password
  // - new_password: Minimum 8 characters, complexity requirements
  // - Passwords must be different
  //
  // EVENTS PUBLISHED:
  // - PasswordChangedEvent: On successful change
  //
  // SECURITY:
  // - Rate limited: 5 attempts per hour per user
  // - Failed attempts logged for security monitoring
  // - Account locked after 5 failed attempts
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Password validation failure
  // - UNAUTHENTICATED: Current password incorrect
  // - PERMISSION_DENIED: Can only change own password
  // - RESOURCE_EXHAUSTED: Rate limit exceeded
  //
  // COMPLIANCE:
  // - NIST 800-63B: Password security requirements
  // - SOC 2 CC6.1: Authentication credential management
  rpc ChangePassword(users.v1.ChangePasswordRequest) returns (users.v1.ChangePasswordResponse);

  // UpdateUserStatus changes a user's account status.
  //
  // Updates user status (active, inactive, suspended). Status changes
  // affect user's ability to authenticate and access resources.
  //
  // AUTHENTICATION: Required - Valid bearer token
  // AUTHORIZATION: Requires 'users:update_status' permission or 'admin' role
  //
  // VALIDATION:
  // - status: Must be valid UserStatus enum value
  // - reason: Required for SUSPENDED status
  //
  // EVENTS PUBLISHED:
  // - UserStatusChangedEvent: On successful status change
  //
  // SECURITY:
  // - Suspension requires documented reason
  // - Audit log includes actor and reason
  // - Notifications sent on status changes
  //
  // ERRORS:
  // - INVALID_ARGUMENT: Invalid status or missing reason
  // - NOT_FOUND: User not found
  // - PERMISSION_DENIED: Insufficient permissions
  // - FAILED_PRECONDITION: Cannot suspend last admin
  //
  // COMPLIANCE:
  // - SOC 2 CC6.2: Access termination and modification
  // - ISO 27001 A.9.2.6: Removal or adjustment of access rights
  rpc UpdateUserStatus(users.v1.UpdateUserStatusRequest) returns (users.v1.UpdateUserStatusResponse);
}
