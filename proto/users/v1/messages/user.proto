// Copyright 2024 GeniusTechSpace
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// User Message Definition
//
// This file defines the core User entity for the user management domain.
// It represents a user account within a multi-tenant system with full
// profile information, preferences, and security status tracking.
//
// COMPLIANCE:
// - GDPR Article 5: Data minimization and purpose limitation
// - GDPR Article 25: Data protection by design and by default
// - SOC 2 CC6.1: Logical and physical access controls
// - ISO 27001 A.9.2: User access management
// - HIPAA 164.312(a)(1): Access control (when handling PHI)
//
// SECURITY:
// - All PII fields (email, phone) must be encrypted at rest
// - Access requires valid authentication token
// - Tenant isolation enforced via tenant_id field
// - Password field intentionally excluded (stored separately with encryption)
//
// AUDIT:
// - All changes tracked via metadata.updated_by and metadata.updated_at
// - Full audit trail maintained via metadata.audit_trail (v2)
// - Soft delete supported via metadata.deleted flag

syntax = "proto3";

package users.v1;

import "buf/validate/validate.proto";
import "core/v1/common.proto";
import "google/protobuf/timestamp.proto";
import "users/v1/enums/user_status.proto";
import "users/v1/messages/user_preferences.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Users.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/users/v1;usersv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.users.v1";

// User represents a complete user profile within a tenant organization.
//
// This is the primary aggregate root for user management operations. Each user
// belongs to exactly one tenant and maintains their profile information,
// preferences, security status, and role assignments.
//
// GDPR COMPLIANCE:
// - Subject to right of access (Article 15)
// - Subject to right of rectification (Article 16)
// - Subject to right to erasure (Article 17)
// - Subject to right to data portability (Article 20)
//
// DATA CLASSIFICATION: PII (Personally Identifiable Information)
// RETENTION POLICY: Soft delete after account termination, permanent delete after retention period
// ENCRYPTION: Email and phone fields must be encrypted at rest
//
// VALIDATION RULES:
// - tenant_id: Required, non-empty (enforces multi-tenant isolation)
// - email: Required, valid email format, unique within tenant
// - username: Required, 3-50 characters, alphanumeric with underscore/hyphen only
// - first_name, last_name: Required, 1-100 characters
// - avatar_url: Optional, must be valid URI if provided
// - status: Must be one of the defined enum values
//
// EXAMPLE USAGE:
//   User user = User.newBuilder()
//       .setMetadata(metadata)
//       .setTenantId("tenant_123")
//       .setEmail("user@example.com")
//       .setUsername("johndoe")
//       .setFirstName("John")
//       .setLastName("Doe")
//       .setStatus(UserStatus.USER_STATUS_ACTIVE)
//       .build();
message User {
  // Unique metadata including ID, timestamps, version, and audit information.
  // This field provides complete audit trail and enables optimistic locking.
  // REQUIRED: Must be set for all persisted User entities.
  core.v1.Metadata metadata = 1;

  // Tenant identifier for multi-tenant isolation.
  // REQUIRED: Must be non-empty to enforce proper data isolation.
  // COMPLIANCE: Critical for SOC 2 CC6.1 (Logical access controls)
  // VALIDATION: Minimum length 1 character
  string tenant_id = 2 [(buf.validate.field).string.min_len = 1];

  // User's primary email address.
  // REQUIRED: Must be a valid email format and unique within the tenant.
  // PII: Yes - Subject to GDPR protection
  // ENCRYPTION: Must be encrypted at rest
  // COMPLIANCE: GDPR Article 4(1) - Personal data identifier
  // VALIDATION: Valid email format
  string email = 3 [(buf.validate.field).string.email = true];

  // Unique username within the tenant for login purposes.
  // REQUIRED: Must be 3-50 characters, alphanumeric with underscore/hyphen only.
  // COMPLIANCE: Used for authentication (SOC 2 CC6.1)
  // VALIDATION: Pattern ^[a-zA-Z0-9_-]+$, length 3-50
  string username = 4 [(buf.validate.field).string = {
    min_len: 3
    max_len: 50
    pattern: "^[a-zA-Z0-9_-]+$"
  }];

  // User's first name or given name.
  // REQUIRED: Must be 1-100 characters.
  // PII: Yes - Subject to GDPR protection
  // COMPLIANCE: GDPR Article 4(1) - Personal data
  // VALIDATION: Length 1-100 characters
  string first_name = 5 [(buf.validate.field).string = {
    min_len: 1
    max_len: 100
  }];

  // User's last name or family name.
  // REQUIRED: Must be 1-100 characters.
  // PII: Yes - Subject to GDPR protection
  // COMPLIANCE: GDPR Article 4(1) - Personal data
  // VALIDATION: Length 1-100 characters
  string last_name = 6 [(buf.validate.field).string = {
    min_len: 1
    max_len: 100
  }];

  // User's phone number in international format.
  // OPTIONAL: Can be empty if not provided.
  // PII: Yes - Subject to GDPR protection
  // ENCRYPTION: Should be encrypted at rest
  // COMPLIANCE: GDPR Article 4(1) - Personal data identifier
  string phone = 7;

  // URL to user's avatar or profile picture.
  // OPTIONAL: Can be empty if not set.
  // VALIDATION: Must be valid URI if provided
  // SECURITY: Should be served over HTTPS only
  string avatar_url = 8 [(buf.validate.field).string.uri = true];

  // Current status of the user account.
  // REQUIRED: Must be one of the defined UserStatus enum values.
  // COMPLIANCE: SOC 2 CC6.1 - Access status tracking
  // VALIDATION: Must be defined enum value only
  // AUDIT: Status changes trigger UserStatusChangedEvent
  users.v1.UserStatus status = 9 [(buf.validate.field).enum.defined_only = true];

  // Roles assigned to this user within the tenant.
  // OPTIONAL: Empty list means no roles assigned (minimal permissions).
  // COMPLIANCE: SOC 2 CC6.1 - Role-based access control
  // SECURITY: Roles determine authorization permissions
  // AUDIT: Role changes should trigger appropriate events
  repeated string roles = 10;

  // User-specific preferences and settings.
  // OPTIONAL: Can be null if user hasn't set preferences.
  // COMPLIANCE: GDPR Article 7 - Consent tracking in preferences
  users.v1.UserPreferences preferences = 11;

  // Timestamp of user's last successful login.
  // OPTIONAL: Null for users who have never logged in.
  // COMPLIANCE: SOC 2 CC6.8 - Monitoring activities
  // AUDIT: Updated on each successful authentication
  // SECURITY: Used for session timeout and inactive account detection
  google.protobuf.Timestamp last_login_at = 12;

  // Flag indicating if user's email has been verified.
  // DEFAULT: false
  // COMPLIANCE: SOC 2 CC6.1 - Identity verification
  // SECURITY: Required before granting full access
  // AUDIT: Verification triggers UserEmailVerifiedEvent
  bool email_verified = 13;

  // Flag indicating if user's phone has been verified.
  // DEFAULT: false
  // COMPLIANCE: SOC 2 CC6.1 - Multi-factor authentication support
  // SECURITY: Required for SMS-based MFA
  // AUDIT: Verification triggers UserPhoneVerifiedEvent
  bool phone_verified = 14;
}
