// DOMAIN: Core - Entity Metadata
// COMPLIANCE: SOC 2 CC6.3 (Change management), GDPR Article 5(2) (Accountability)
// SECURITY: Audit trail tracking for all entity lifecycle events
// PII: Yes - created_by and updated_by fields contain user identifiers

syntax = "proto3";

package geniustechspace.core.metadata.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Core.Metadata.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/core/metadata/v1;metadatav1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.core.metadata.v1";

// Metadata provides comprehensive audit trail and version control for all entities.
//
// PURPOSE: Complete audit trail for compliance, versioning for optimistic locking,
//          and soft delete support for data retention requirements
// COMPLIANCE: SOC 2 CC6.3 (Change management), GDPR Article 5(2) (Accountability)
// AUDIT: Tracks who created/modified entities and when for forensic analysis
// USAGE: Embedded in all domain entities (User, Tenant, Role, Subscription, etc.)
message Metadata {
  // Unique entity identifier. REQUIRED, immutable after creation.
  // FORMAT: any string format (UUID, ULID, custom) recommended for global uniqueness
  // GENERATION: Generated server-side on entity creation
  // VALIDATION: Must be a valid identifier format
  // Example: "usr_01HQZX5J8K9M3N4P5Q6R7S8T9V" or UUID
  string id = 1 [(buf.validate.field).string = {
    min_len: 1
    max_len: 128
  }];

  // Entity creation timestamp. REQUIRED, immutable.
  // COMPLIANCE: SOC 2 CC6.3 audit requirement for entity lifecycle tracking
  // TIMEZONE: Always UTC
  // GENERATION: Set automatically on entity creation
  google.protobuf.Timestamp created_at = 2 [(buf.validate.field).required = true];

  // Last modification timestamp. REQUIRED, automatically updated.
  // PURPOSE: Tracks when entity was last changed for cache invalidation and auditing
  // TIMEZONE: Always UTC
  // BEHAVIOR: Updated automatically on every entity modification
  google.protobuf.Timestamp updated_at = 3 [(buf.validate.field).required = true];

  // User ID who created this entity. REQUIRED for audit trail.
  // COMPLIANCE: SOC 2 CC6.3 - Required for accountability and compliance audits
  // FORMAT: User ID from authentication context
  // PII: Yes - User identifier
  // Example: "usr_01HQZX5J8K9M3N4P5Q6R7S8T9V"
  string created_by = 4 [(buf.validate.field).string = {
    min_len: 1
    max_len: 128
  }];

  // User ID who last modified this entity. REQUIRED for audit trail.
  // COMPLIANCE: SOC 2 CC6.3 - Tracks who made changes for accountability
  // BEHAVIOR: Updated on every modification to reflect current modifier
  // PII: Yes - User identifier
  // Example: "usr_01HQZX5J8K9M3N4P5Q6R7S8T9V"
  string updated_by = 5 [(buf.validate.field).string = {
    min_len: 1
    max_len: 128
  }];

  // Version number for optimistic locking preventing concurrent update conflicts.
  // REQUIRED for entities supporting concurrent modifications.
  // PURPOSE: Prevents lost updates in distributed systems
  //
  // BEHAVIOR:
  //   - Starts at 1 on entity creation
  //   - Incremented on every update
  //   - Update fails if client version doesn't match current version
  //
  // USAGE:
  //   1. Client reads entity with version=5
  //   2. Client modifies entity locally
  //   3. Client sends update with version=5
  //   4. Server checks: if current version != 5, reject update (conflict)
  //   5. Server increments version to 6 on successful update
  int64 version = 6 [(buf.validate.field).int64 = {gte: 1}];

  // Soft delete flag indicating logical deletion without physical removal.
  // REQUIRED for entities with data retention requirements.
  // COMPLIANCE: GDPR Article 17 (Right to erasure with retention requirements)
  // PURPOSE: Allows "deletion" while retaining data for:
  //   - Audit trails and compliance investigations
  //   - Referential integrity in related records
  //   - Legal holds and e-discovery
  //
  // BEHAVIOR:
  //   - When true, entity is hidden from normal queries
  //   - Special queries needed to retrieve deleted entities
  //   - Physical deletion may occur after retention period
  bool deleted = 7;

  // Deletion timestamp set when entity is soft deleted. Optional.
  // BEHAVIOR: Set automatically when deleted flag changes to true
  // PURPOSE: Track deletion time for retention policy enforcement
  // COMPLIANCE: Required for demonstrating retention policy compliance
  google.protobuf.Timestamp deleted_at = 8;
}
