// Session Messages - Production v1
//
// Enterprise-grade session management for users, clients, and AI agents.
// Multitenant aware. Follows Genius Tech Space design patterns.
//
// COMPLIANCE:
//   - OWASP Session Management Cheat Sheet
//   - NIST 800-63B (Digital Identity Guidelines)
//   - GDPR Article 25 (Data Protection by Design)
//   - SOC 2 Type II (Access Control)
//   - PSD2 (Strong Customer Authentication)
//
// SECURITY:
//   - Session binding: Track device/client/network context
//   - Short expiration: 15min idle, 24h absolute (configurable)
//   - Secure transport: TLS 1.3+ required
//   - No sensitive data: Tokens stored separately
//   - Audit logging: All lifecycle events logged
//
// PRIVACY:
//   - PII fields: user_id, agent_id
//   - Retention: 90 days post-expiration
//   - Right to erasure: Include in user deletion
//   - Data minimization: Only essential fields

syntax = "proto3";

package geniustechspace.core.session.v1;

import "buf/validate/validate.proto";
import "core/session/v1/enums.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Core.Session.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/core/session/v1;sessionv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.core.session.v1";

// Session: Comprehensive session data structure for multitenant environments
//
// SECURITY: Contains PII - encrypt user_id/agent_id at rest
// COMPLIANCE: SOC 2 audit trail required for all state changes
// ARCHITECTURE: Flat design - context references by ID only
message Session {
  reserved 5 to 9, 14 to 19, 26 to 29, 34 to 39, 55 to 99;

  // ============ IDENTIFIERS ============

  // Unique session identifier
  string session_id = 1 [(buf.validate.field).string = {
    min_len: 8
    max_len: 128
  }];

  // Tenant context
  string tenant_path = 2 [(buf.validate.field).string = {
    min_len: 3
    max_len: 64
  }];

  // User/Actor identifiers (at least one required)
  oneof actor {
    string user_id = 3 [(buf.validate.field).string = {max_len: 128}];
    string agent_id = 4 [(buf.validate.field).string = {max_len: 128}];
  }

  // ============ CONTEXT REFERENCES ============

  // Context references (lookup by ID)
  string device_id = 10 [(buf.validate.field).string = {max_len: 128}];
  string client_id = 11 [(buf.validate.field).string = {max_len: 128}];
  string network_id = 12 [(buf.validate.field).string = {max_len: 128}];
  string geo_location_id = 13 [(buf.validate.field).string = {max_len: 128}];

  // ============ SESSION STATE ============

  // Session lifecycle status (active, expired, revoked)
  SessionStatus status = 20;

  // ============ AUTHENTICATION STATE ============

  // Authentication status (whether session is fully authenticated)
  AuthenticationStatus auth_status = 21;

  // Primary authentication method used
  AuthenticationMethod primary_auth_method = 22;

  // Additional authentication methods (for MFA)
  repeated AuthenticationMethod additional_auth_methods = 23 [(buf.validate.field).repeated.max_items = 5];

  // Required MFA methods (if MFA pending)
  repeated MFAType required_mfa_methods = 24 [(buf.validate.field).repeated.max_items = 5];

  // Completed MFA methods (if MFA in progress)
  repeated MFAType completed_mfa_methods = 25 [(buf.validate.field).repeated.max_items = 5];

  // ============ AUTHORIZATION ============

  // Actor/User roles
  repeated string roles = 30 [(buf.validate.field).repeated.max_items = 20];

  // Actor/User permissions
  repeated string permissions = 31 [(buf.validate.field).repeated.max_items = 100];

  // ============ METADATA ============

  // Session metadata
  map<string, string> metadata = 40;

  // ============ TIMESTAMPS ============

  // Session lifecycle timestamps
  google.protobuf.Timestamp created_at = 50;
  google.protobuf.Timestamp updated_at = 51;
  google.protobuf.Timestamp expires_at = 52;
  google.protobuf.Timestamp authenticated_at = 53; // When auth completed
  google.protobuf.Timestamp mfa_completed_at = 54; // When MFA completed
}
