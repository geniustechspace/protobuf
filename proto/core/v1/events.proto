// Core Events - Event Sourcing Foundation
//
// Defines base event structures for event-driven architecture supporting
// event sourcing, CQRS patterns, and distributed tracing across all domains.
//
// COMPLIANCE: SOC 2 CC7.2 (System monitoring), ISO 27001 A.12.4.1 (Event logging)
// AUDIT: All events immutable. Complete audit trail maintained.
// SECURITY: Events contain tenant context for isolation. PII handling per domain.

syntax = "proto3";

package core.v1;

import "core/v1/common.proto";
import "google/protobuf/any.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Core.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/core/v1;corev1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.core.v1";

// BaseEvent is the foundation for all domain events in event sourcing patterns.
//
// COMPLIANCE: SOC 2 CC7.2 (Audit logging), ISO 27001 A.12.4.1 (Event logging)
// IMMUTABLE: Events never modified after creation (append-only)
message BaseEvent {
  // Unique event identifier (UUID v4). REQUIRED
  string event_id = 1;

  // Event type identifier (e.g., "user.created", "tenant.updated"). REQUIRED
  string event_type = 2;

  // Aggregate/entity ID that triggered event. REQUIRED
  string aggregate_id = 3;

  // Aggregate type (e.g., "user", "tenant", "subscription"). REQUIRED
  string aggregate_type = 4;

  // Tenant context for multi-tenant isolation. REQUIRED
  TenantContext tenant_context = 5;

  // Event occurrence timestamp (UTC). REQUIRED
  google.protobuf.Timestamp occurred_at = 6;

  // User/service that triggered event. PII: User identifier
  string triggered_by = 7;

  // Event schema version for evolution (default: 1)
  int32 event_version = 8;

  // Domain-specific event payload (Any type for flexibility)
  google.protobuf.Any payload = 9;

  // Additional event metadata (custom fields)
  map<string, string> metadata = 10;

  // Correlation ID for distributed tracing (spans multiple events)
  string correlation_id = 11;

  // Causation ID links to event that caused this event (event chain)
  string causation_id = 12;
}

// EventEnvelope wraps events for transport in event streaming systems.
//
// Used for Kafka, Pulsar, or other event streaming platforms.
message EventEnvelope {
  // Base event with all data
  BaseEvent event = 1;

  // Partition key for event stream routing (typically tenant_id)
  string partition_key = 2;

  // Sequence number for ordering within partition
  int64 sequence = 3;
}

// EventBatch groups events for efficient batch processing.
//
// Used for batch ETL, analytics, and bulk replay operations.
message EventBatch {
  // Events in this batch
  repeated BaseEvent events = 1;

  // Batch identifier (UUID)
  string batch_id = 2;

  // Batch creation timestamp
  google.protobuf.Timestamp batch_timestamp = 3;
}
