// User Management API Request Messages
//
// Request messages for User domain CRUD operations and status management.
//
// DOMAIN: Identity - User Management
// VERSION: v1
// COMPLIANCE: SOC 2 CC6.1, GDPR Articles 5/17, ISO 27001 A.9.2
// PII: Yes - Contains personal identifiers and user data
//
// For detailed documentation, see README.md in this directory.
// For license information, see LICENSE in this directory.

syntax = "proto3";

package geniustechspace.idp.identity.user.api.v1;

import "buf/validate/validate.proto";
import "core/api/pagination/v1/messages.proto";
import "core/common/v1/common.proto";
import "google/protobuf/field_mask.proto";
import "idp/identity/user/v1/user.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.User.Api.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/user/api/v1;userapiv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.user.api.v1";

// CreateUserRequest creates new user account.
// OFFLINE SUPPORT: user_id can be pre-generated (any string format (UUID, ULID, custom)) for offline-first apps.
message CreateUserRequest {
  // User data to create.
  // REQUIRED: Yes - must include tenant_path and email
  // OFFLINE: user_id can be pre-generated; if omitted, server generates it
  // PII: Yes - contains personal identifiers per GDPR Article 4(1)
  // NOTE: created_at, updated_at, deleted_at, version are server-managed and ignored
  geniustechspace.idp.identity.user.v1.User data = 1;

  // Reserved for future request parameters.
  reserved 2 to 9;
}

// GetUserRequest retrieves user by ID, email, or username.
// PATTERN: Uses oneof discriminator for multiple lookup strategies.
message GetUserRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Lookup strategy: exactly one must be set.
  // VALIDATION: Server validates exactly one field is populated.
  oneof identifier {
    // User ID to retrieve.
    string user_id = 2 [(buf.validate.field).string.max_len = 512];

    // User email address.
    string email = 3 [(buf.validate.field).string.email = true];

    // Username.
    string username = 4 [(buf.validate.field).string = {
      min_len: 3
      max_len: 32
    }];
  }

  // Reserved for future query parameters.
  reserved 5 to 9;
}

// UpdateUserRequest modifies existing user (partial update).
// PATTERN: Entity contains tenant_path and identifier (user_id/email/username) for lookup.
message UpdateUserRequest {
  // User data with fields to update. Must include tenant_path and identifier.
  // REQUIRED: Yes - must contain tenant_path + (user_id OR email OR username) for lookup
  // PII: Yes - contains personal data per GDPR Article 4(1)
  // AUDIT: Changes logged with before/after snapshots
  // PARTIAL UPDATE: Only fields listed in update_mask are modified
  // NOTE: created_at, updated_at, deleted_at, version are server-managed and ignored
  geniustechspace.idp.identity.user.v1.User data = 1;

  // Field mask specifying which fields to update.
  // REQUIRED: Yes - explicit intent required for updates
  // PATTERN: Dot notation paths like "display_name", "given_name", "metadata.key1"
  // ENTERPRISE STANDARD: Google Cloud API standard for partial updates
  // VALIDATION: Server validates paths exist and are mutable
  // EXAMPLES:
  //   - Update names: paths: ["given_name", "family_name", "display_name"]
  //   - Update contact: paths: ["email", "phone_number"]
  //   - Update nested: paths: ["metadata.department", "metadata.employee_id"]
  //   - Update all: paths: ["*"] (use with caution)
  google.protobuf.FieldMask update_mask = 2 [(buf.validate.field).required = true];

  // Reserved for future update options.
  reserved 3 to 9;
}

// DeleteUserRequest soft-deletes or hard-deletes user.
message DeleteUserRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID to delete.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Hard delete flag. If true, permanently removes user data (GDPR erasure).
  // If false, performs soft delete (sets deleted_at). Defaults to false.
  // REQUIRED: No (defaults to false)
  // COMPLIANCE: GDPR Article 17 (Right to erasure) requires true for user requests
  // AUDIT: Hard deletes logged with full user snapshot
  bool hard_delete = 3;

  // Reason for deletion.
  // REQUIRED: No (optional)
  // AUDIT: Logged for compliance (SOC 2 CC6.3)
  // VALIDATION: Max 500 characters
  string reason = 4 [(buf.validate.field).string.max_len = 500];

  // Reserved for future deletion options.
  reserved 5 to 9;
}

// ListUsersRequest retrieves paginated list of users.
message ListUsersRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Pagination parameters.
  // REQUIRED: No (defaults to page=1, page_size=20)
  geniustechspace.core.api.pagination.v1.PaginationRequest pagination = 2;

  // Optional filters.
  // Filter by organization membership.
  optional string organization_id = 3 [(buf.validate.field).string.max_len = 512];

  // Filter by group membership.
  optional string group_id = 4 [(buf.validate.field).string.max_len = 512];

  // Filter by user status.
  optional geniustechspace.idp.identity.user.v1.UserStatus status = 5 [(buf.validate.field).enum.defined_only = true];

  // Reserved for additional filters (role, created_after, etc.).
  reserved 6 to 9;
}

// SearchUsersRequest performs full-text user search.
message SearchUsersRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Search query (searches email, username, display_name, given_name, family_name).
  // REQUIRED: Yes
  // VALIDATION: Minimum 2 characters to prevent performance issues
  string query = 2 [(buf.validate.field).string.min_len = 2];

  // Pagination parameters.
  // REQUIRED: No (defaults to page=1, page_size=20)
  geniustechspace.core.api.pagination.v1.PaginationRequest pagination = 3;

  // Optional filters.
  // Filter results by user status.
  optional geniustechspace.idp.identity.user.v1.UserStatus status = 4 [(buf.validate.field).enum.defined_only = true];

  // Reserved for additional search filters.
  reserved 5 to 9;
}

// UpdateUserStatusRequest changes user account status.
message UpdateUserStatusRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID to update.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // New status.
  // REQUIRED: Yes
  // VALIDATION: Must not be UNSPECIFIED (0)
  geniustechspace.idp.identity.user.v1.UserStatus status = 3 [(buf.validate.field).enum = {
    defined_only: true
    not_in: [0] /* Cannot set to UNSPECIFIED */
  }];

  // Reason for status change.
  // REQUIRED: No (optional but recommended)
  // AUDIT: Logged for compliance (SOC 2 CC6.3)
  // VALIDATION: Max 500 characters
  string reason = 4 [(buf.validate.field).string.max_len = 500];

  // Reserved for future status options (effective_at, expires_at, etc.).
  reserved 5 to 9;
}

// VerifyUserEmailRequest marks email as verified.
message VerifyUserEmailRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID to verify.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Verification token (if token-based).
  // REQUIRED: No (optional - omit for admin override)
  // VALIDATION: If provided, must match stored token
  // SECURITY: Token expires after 24 hours
  optional string verification_token = 3;

  // Reserved for future verification options.
  reserved 4 to 9;
}

// VerifyUserPhoneRequest marks phone as verified.
message VerifyUserPhoneRequest {
  // Tenant path for multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID to verify.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Verification code (if code-based).
  // REQUIRED: No (optional - omit for admin override)
  // VALIDATION: If provided, must match 6-digit OTP sent via SMS
  // SECURITY: Code expires after 10 minutes, max 3 attempts
  optional string verification_code = 3;

  // Reserved for future verification options.
  reserved 4 to 9;
}
