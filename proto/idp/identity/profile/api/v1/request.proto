// Profile Management API Request Messages
//
// Request messages for UserProfile domain CRUD operations and management.
//
// DOMAIN: Identity - Profile Management
// VERSION: v1
// COMPLIANCE: SOC 2 CC6.1, GDPR Articles 5/9, ISO 27001 A.9.2
// PII: Yes - Contains personal identity information
//
// For detailed documentation, see README.md in this directory.

syntax = "proto3";

package geniustechspace.idp.identity.profile.api.v1;

import "buf/validate/validate.proto";
import "core/api/pagination/v1/messages.proto";
import "core/common/v1/common.proto";
import "google/protobuf/field_mask.proto";
import "idp/identity/profile/v1/profile.proto";
import "idp/identity/profile/v1/social.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.Profile.Api.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/profile/api/v1;profileapiv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.profile.api.v1";

// CreateProfileRequest creates new user profile.
// OFFLINE SUPPORT: profile_id can be pre-generated (any string format (UUID, ULID, custom)) for offline-first apps.
message CreateProfileRequest {
  // Profile data to create.
  // REQUIRED: Yes - must include tenant_path and user_id
  // OFFLINE: profile_id can be pre-generated; if omitted, server generates it
  // PII: Yes - contains personal identity information per GDPR Article 4(1) and Article 9
  // NOTE: created_at, updated_at, deleted_at, version are server-managed and ignored
  geniustechspace.idp.identity.profile.v1.UserProfile data = 1;

  // Reserved for future request parameters.
  reserved 2 to 9;
}

// GetProfileRequest retrieves profile by ID or user ID.
// PATTERN: Uses oneof discriminator for multiple lookup strategies.
// ENTERPRISE STANDARD: Follows Google Cloud API Design Guide for resource retrieval.
message GetProfileRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Lookup strategy: exactly one must be set.
  // VALIDATION: Server validates exactly one field is populated.
  oneof identifier {
    // Profile ID to retrieve.
    // Use when you have the profile's unique identifier.
    string profile_id = 2 [(buf.validate.field).string.max_len = 512];

    // User ID owning the profile.
    // Use when you want to find profile by user ID.
    string user_id = 3 [(buf.validate.field).string.max_len = 512];
  }

  // Reserved for future query parameters.
  reserved 4 to 9;
}

// UpdateProfileRequest modifies existing profile (partial update).
// PATTERN: Entity contains tenant_path and identifier (profile_id/user_id) for lookup.
// ENTERPRISE STANDARD: Follows Google Cloud API Design Guide for update operations.
message UpdateProfileRequest {
  // Profile data with fields to update. Must include tenant_path and identifier.
  // REQUIRED: Yes - must contain tenant_path + (profile_id OR user_id) for lookup
  // PII: Yes - contains personal data per GDPR Article 4(1) and Article 9
  // AUDIT: Changes logged with before/after snapshots
  // PARTIAL UPDATE: Only fields listed in update_mask are modified
  // NOTE: created_at, updated_at, deleted_at, version are server-managed and ignored
  geniustechspace.idp.identity.profile.v1.UserProfile data = 1;

  // Field mask specifying which fields to update.
  // REQUIRED: Yes - explicit intent required for updates
  // PATTERN: Dot notation paths like "given_name", "family_name", "custom_attributes.key1"
  // ENTERPRISE STANDARD: Google Cloud API standard (Cloud Storage, Firestore, etc.)
  // VALIDATION: Server validates paths exist and are mutable
  // EXAMPLES:
  //   - Update name: paths: ["given_name", "family_name"]
  //   - Update nested: paths: ["custom_attributes.company", "custom_attributes.department"]
  //   - Update all: paths: ["*"] (use with caution)
  google.protobuf.FieldMask update_mask = 2 [(buf.validate.field).required = true];

  // Reserved for future update options.
  reserved 3 to 9;
}

// DeleteProfileRequest soft-deletes profile.
message DeleteProfileRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Profile ID to delete.
  // REQUIRED: Yes
  string profile_id = 2 [(buf.validate.field).string.max_len = 512];

  // Reason for deletion.
  // REQUIRED: No (optional)
  // AUDIT: Logged for compliance (SOC 2 CC6.3)
  string reason = 3 [(buf.validate.field).string.max_len = 500];

  // GDPR erasure request flag.
  // COMPLIANCE: GDPR Article 17 (Right to erasure)
  bool gdpr_erasure_request = 4;

  // Reserved for future deletion options.
  reserved 5 to 9;
}

// ListProfilesRequest retrieves paginated list of profiles.
message ListProfilesRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Pagination parameters.
  // REQUIRED: No (defaults to page=1, page_size=20)
  geniustechspace.core.api.pagination.v1.PaginationRequest pagination = 2;

  // Reserved for additional filters.
  reserved 3 to 9;
}

// SearchProfilesRequest performs full-text profile search.
message SearchProfilesRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Search query (searches given_name, family_name, nickname, bio).
  // REQUIRED: Yes
  // VALIDATION: Minimum 2 characters to prevent performance issues
  string query = 2 [(buf.validate.field).string.min_len = 2];

  // Pagination parameters.
  // REQUIRED: No (defaults to page=1, page_size=20)
  geniustechspace.core.api.pagination.v1.PaginationRequest pagination = 3;

  // Reserved for additional search filters.
  reserved 4 to 9;
}

// LinkSocialProfileRequest links social media profile to user.
message LinkSocialProfileRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID linking the social profile.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Social profile data. Provider, username, and profile_url are required.
  // PII: Yes - contains social media identifiers
  // NOTE: social_profile_id, user_id, tenant_path, verified_at, created_at, updated_at, deleted_at, version are ignored if provided
  geniustechspace.idp.identity.profile.v1.UserSocialProfile social_profile = 3;

  // Reserved for future parameters.
  reserved 4 to 9;
}

// UnlinkSocialProfileRequest unlinks social media profile.
message UnlinkSocialProfileRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Social profile ID to unlink.
  // REQUIRED: Yes
  string social_profile_id = 2 [(buf.validate.field).string.max_len = 512];

  // Reason for unlinking.
  // REQUIRED: No (optional)
  string reason = 3 [(buf.validate.field).string.max_len = 500];

  // Reserved for future parameters.
  reserved 4 to 9;
}

// VerifySocialProfileRequest verifies social media profile.
message VerifySocialProfileRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // Social profile ID to verify.
  // REQUIRED: Yes
  string social_profile_id = 2 [(buf.validate.field).string.max_len = 512];

  // Verification method (oauth, manual, admin).
  // REQUIRED: Yes
  string verification_method = 3;

  // Reserved for future parameters.
  reserved 4 to 9;
}

// ListSocialProfilesRequest retrieves user's social profiles.
message ListSocialProfilesRequest {
  // Tenant path for hierarchical multi-tenancy isolation.
  // REQUIRED: Yes
  string tenant_path = 1 [(buf.validate.field).string.max_len = 512];

  // User ID owning the social profiles.
  // REQUIRED: Yes
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Filter by provider.
  // REQUIRED: No (optional)
  optional string provider = 3;

  // Reserved for additional filters.
  reserved 4 to 9;
}
