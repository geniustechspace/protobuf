// DOMAIN: Identity Provider - Identity Core Operations
// COMPLIANCE: SOC 2 CC6.1, GDPR Article 5, ISO 27001 A.9.2
// SECURITY: Authentication required, tenant isolation enforced
// PII: Contains user identifiers

syntax = "proto3";

package geniustechspace.idp.identity.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/v1;idpidentityv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.v1";

// VerifyEmailRequest initiates email verification.
// AUTHENTICATION: Required
// AUTHORIZATION: Self or 'users:update' permission
message VerifyEmailRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];

  // Email. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string email = 3 [(buf.validate.field).string.email = true];
}

// VerifyEmailResponse returns verification token.
message VerifyEmailResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  // E.g., "Verification email sent"
  string message = 2;

  // Expires at. OPTIONAL.
  // When verification token expires.
  google.protobuf.Timestamp expires_at = 3;
}

// ConfirmEmailVerificationRequest confirms email with token.
// AUTHENTICATION: Public (token-based)
message ConfirmEmailVerificationRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];

  // Token. REQUIRED.
  // Verification token from email.
  string token = 3 [(buf.validate.field).string.min_len = 1];
}

// ConfirmEmailVerificationResponse confirms email verification.
message ConfirmEmailVerificationResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  string message = 2;

  // Verified at. OPTIONAL.
  google.protobuf.Timestamp verified_at = 3;
}

// VerifyPhoneRequest initiates phone verification.
// AUTHENTICATION: Required
// AUTHORIZATION: Self or 'users:update' permission
message VerifyPhoneRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];

  // Phone number. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  // VALIDATION: E.164 format
  string phone_number = 3 [(buf.validate.field).string.pattern = "^\\+[1-9]\\d{1,14}$"];
}

// VerifyPhoneResponse returns verification sent status.
message VerifyPhoneResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  // E.g., "Verification code sent via SMS"
  string message = 2;

  // Expires at. OPTIONAL.
  google.protobuf.Timestamp expires_at = 3;
}

// ConfirmPhoneVerificationRequest confirms phone with code.
// AUTHENTICATION: Required
message ConfirmPhoneVerificationRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];

  // Code. REQUIRED.
  // 6-digit verification code.
  string code = 3 [(buf.validate.field).string.pattern = "^[0-9]{6}$"];
}

// ConfirmPhoneVerificationResponse confirms phone verification.
message ConfirmPhoneVerificationResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  string message = 2;

  // Verified at. OPTIONAL.
  google.protobuf.Timestamp verified_at = 3;
}

// SearchIdentitiesRequest searches for users, groups, organizations.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'identities:search' permission
message SearchIdentitiesRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Query. REQUIRED.
  // Search query string.
  string query = 2 [(buf.validate.field).string.min_len = 1];

  // Types. OPTIONAL.
  // Filter by entity types.
  repeated IdentityType types = 3;

  // Page size. OPTIONAL.
  int32 page_size = 4 [(buf.validate.field).int32 = {
    gte: 1
    lte: 100
  }];

  // Page token. OPTIONAL.
  string page_token = 5;
}

// IdentityType represents searchable entity type.
enum IdentityType {
  IDENTITY_TYPE_UNSPECIFIED = 0;
  USER = 1;
  GROUP = 2;
  ORGANIZATION = 3;
  reserved 4 to 10;
}

// SearchIdentitiesResponse returns search results.
message SearchIdentitiesResponse {
  // Results. REQUIRED.
  repeated IdentitySearchResult results = 1;

  // Next page token. OPTIONAL.
  string next_page_token = 2;

  // Total count. OPTIONAL.
  int32 total_count = 3;
}

// IdentitySearchResult represents a search result.
message IdentitySearchResult {
  // ID. REQUIRED.
  string id = 1;

  // Type. REQUIRED.
  IdentityType type = 2;

  // Display name. REQUIRED.
  string display_name = 3;

  // Description. OPTIONAL.
  string description = 4;

  // Email. OPTIONAL.
  // For user results.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string email = 5;

  // Avatar URL. OPTIONAL.
  string avatar_url = 6;
}
