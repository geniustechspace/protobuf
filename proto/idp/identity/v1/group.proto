// DOMAIN: Identity Provider - Group Entity
// COMPLIANCE: SOC 2 CC6.1, GDPR Article 5, ISO 27001 A.9.2
// SECURITY: Authentication required, tenant isolation enforced
// PII: May contain user identifiers

syntax = "proto3";

package geniustechspace.idp.identity.v1;

import "buf/validate/validate.proto";
import "core/metadata/v1/metadata.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/v1;idpidentityv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.v1";

// Group represents a collection of users.
// Used for organizing users and assigning permissions/roles.
message Group {
  // Group ID. REQUIRED.
  string id = 1 [(buf.validate.field).string.min_len = 1];

  // Tenant ID. REQUIRED.
  string tenant_id = 2 [(buf.validate.field).string.min_len = 1];

  // Name. REQUIRED.
  // Unique within tenant.
  string name = 3 [(buf.validate.field).string = {
    min_len: 1
    max_len: 128
  }];

  // Display name. REQUIRED.
  string display_name = 4 [(buf.validate.field).string.min_len = 1];

  // Description. OPTIONAL.
  string description = 5;

  // Type. REQUIRED.
  GroupType type = 6 [(buf.validate.field).enum.defined_only = true];

  // Parent group ID. OPTIONAL.
  // For hierarchical groups.
  string parent_group_id = 7;

  // Organization ID. OPTIONAL.
  // Organization this group belongs to.
  string organization_id = 8;

  // Member user IDs. OPTIONAL.
  // Direct members (not inherited from parent groups).
  repeated string member_user_ids = 9;

  // Member count. OPTIONAL.
  // Total number of members (including inherited).
  int32 member_count = 10;

  // Role IDs. OPTIONAL.
  // Roles assigned to this group.
  repeated string role_ids = 11;

  // Tags. OPTIONAL.
  repeated string tags = 12;

  // Metadata. OPTIONAL.
  core.metadata.v1.Metadata metadata = 13;
}

// GroupType represents group category.
enum GroupType {
  GROUP_TYPE_UNSPECIFIED = 0;
  SYSTEM = 1; // System-defined group (immutable)
  CUSTOM = 2; // Custom tenant-defined group
  DEPARTMENT = 3; // Department group
  TEAM = 4; // Team group
  PROJECT = 5; // Project-based group
  ROLE_BASED = 6; // Role-based group
  reserved 7 to 20;
}

// CreateGroupRequest creates new group.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:create' permission
message CreateGroupRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Name. REQUIRED.
  string name = 2 [(buf.validate.field).string = {
    min_len: 1
    max_len: 128
  }];

  // Display name. REQUIRED.
  string display_name = 3 [(buf.validate.field).string.min_len = 1];

  // Description. OPTIONAL.
  string description = 4;

  // Type. REQUIRED.
  GroupType type = 5 [(buf.validate.field).enum.defined_only = true];

  // Parent group ID. OPTIONAL.
  string parent_group_id = 6;

  // Organization ID. OPTIONAL.
  string organization_id = 7;

  // Member user IDs. OPTIONAL.
  repeated string member_user_ids = 8;

  // Role IDs. OPTIONAL.
  repeated string role_ids = 9;

  // Tags. OPTIONAL.
  repeated string tags = 10;
}

// CreateGroupResponse returns created group.
message CreateGroupResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Group. OPTIONAL.
  Group group = 2;

  // Message. OPTIONAL.
  string message = 3;
}

// GetGroupRequest retrieves group by ID.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:read' permission
message GetGroupRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Group ID. REQUIRED.
  string group_id = 2 [(buf.validate.field).string.min_len = 1];
}

// GetGroupResponse returns group.
message GetGroupResponse {
  // Group. REQUIRED.
  Group group = 1;
}

// UpdateGroupRequest updates group.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:update' permission
message UpdateGroupRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Group ID. REQUIRED.
  string group_id = 2 [(buf.validate.field).string.min_len = 1];

  // Display name. OPTIONAL.
  string display_name = 3;

  // Description. OPTIONAL.
  string description = 4;

  // Tags. OPTIONAL.
  repeated string tags = 5;
}

// UpdateGroupResponse returns updated group.
message UpdateGroupResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Group. OPTIONAL.
  Group group = 2;

  // Message. OPTIONAL.
  string message = 3;
}

// DeleteGroupRequest deletes group.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:delete' permission
message DeleteGroupRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Group ID. REQUIRED.
  string group_id = 2 [(buf.validate.field).string.min_len = 1];
}

// DeleteGroupResponse confirms group deletion.
message DeleteGroupResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  string message = 2;
}

// AddGroupMemberRequest adds user to group.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:update' permission
message AddGroupMemberRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Group ID. REQUIRED.
  string group_id = 2 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 3 [(buf.validate.field).string.min_len = 1];
}

// AddGroupMemberResponse confirms member addition.
message AddGroupMemberResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  string message = 2;
}

// RemoveGroupMemberRequest removes user from group.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:update' permission
message RemoveGroupMemberRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Group ID. REQUIRED.
  string group_id = 2 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 3 [(buf.validate.field).string.min_len = 1];
}

// RemoveGroupMemberResponse confirms member removal.
message RemoveGroupMemberResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Message. OPTIONAL.
  string message = 2;
}

// ListGroupsRequest lists groups.
// AUTHENTICATION: Required
// AUTHORIZATION: Requires 'groups:list' permission
message ListGroupsRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // Organization ID. OPTIONAL.
  // Filter by organization.
  string organization_id = 2;

  // Type. OPTIONAL.
  // Filter by type.
  GroupType type = 3;

  // Parent group ID. OPTIONAL.
  // Filter by parent group.
  string parent_group_id = 4;

  // Page size. OPTIONAL.
  int32 page_size = 5 [(buf.validate.field).int32 = {
    gte: 1
    lte: 100
  }];

  // Page token. OPTIONAL.
  string page_token = 6;
}

// ListGroupsResponse returns paginated groups.
message ListGroupsResponse {
  // Groups. REQUIRED.
  repeated Group groups = 1;

  // Next page token. OPTIONAL.
  string next_page_token = 2;

  // Total count. OPTIONAL.
  int32 total_count = 3;
}
