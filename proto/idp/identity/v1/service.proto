// DOMAIN: Identity Provider - Identity Management Service
// COMPLIANCE: SOC 2 CC6.1, GDPR Article 5, ISO 27001 A.9.2
// SECURITY: Authentication required, tenant isolation enforced
// PII: Contains user personal data

syntax = "proto3";

package geniustechspace.idp.identity.v1;

import "idp/identity/v1/group.proto";
import "idp/identity/v1/identity.proto";
import "idp/identity/v1/organization.proto";
import "idp/identity/v1/profile.proto";
import "idp/identity/v1/user.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/v1;idpidentityv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.v1";

// IdentityService provides comprehensive identity management operations.
// COMPLIANCE: GDPR Article 5, ISO 27001 A.9.2, SOC 2 CC6.1
service IdentityService {
  // User Management
  // ===============

  // CreateUser creates new user account.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'users:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);

  // GetUser retrieves user by ID.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetUser(GetUserRequest) returns (GetUserResponse);

  // UpdateUser updates user account.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 20/min per user
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);

  // DeleteUser deletes user account.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'users:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);

  // ListUsers lists users.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'users:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);

  // Profile Management
  // ==================

  // GetUserProfile retrieves user profile.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetUserProfile(GetUserProfileRequest) returns (GetUserProfileResponse);

  // UpdateUserProfile updates user profile.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 20/min per user
  rpc UpdateUserProfile(UpdateUserProfileRequest) returns (UpdateUserProfileResponse);

  // Verification
  // ============

  // VerifyEmail initiates email verification.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 5/hour per user
  rpc VerifyEmail(VerifyEmailRequest) returns (VerifyEmailResponse);

  // ConfirmEmailVerification confirms email with token.
  // AUTHENTICATION: Public (token-based)
  // RATE LIMIT: 10/hour per IP
  rpc ConfirmEmailVerification(ConfirmEmailVerificationRequest) returns (ConfirmEmailVerificationResponse);

  // VerifyPhone initiates phone verification.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 5/hour per user
  rpc VerifyPhone(VerifyPhoneRequest) returns (VerifyPhoneResponse);

  // ConfirmPhoneVerification confirms phone with code.
  // AUTHENTICATION: Required
  // RATE LIMIT: 10/hour per user
  rpc ConfirmPhoneVerification(ConfirmPhoneVerificationRequest) returns (ConfirmPhoneVerificationResponse);

  // Group Management
  // ================

  // CreateGroup creates new group.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreateGroup(CreateGroupRequest) returns (CreateGroupResponse);

  // GetGroup retrieves group by ID.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetGroup(GetGroupRequest) returns (GetGroupResponse);

  // UpdateGroup updates group.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdateGroup(UpdateGroupRequest) returns (UpdateGroupResponse);

  // DeleteGroup deletes group.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeleteGroup(DeleteGroupRequest) returns (DeleteGroupResponse);

  // ListGroups lists groups.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListGroups(ListGroupsRequest) returns (ListGroupsResponse);

  // AddGroupMember adds user to group.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 50/min per tenant
  rpc AddGroupMember(AddGroupMemberRequest) returns (AddGroupMemberResponse);

  // RemoveGroupMember removes user from group.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 50/min per tenant
  rpc RemoveGroupMember(RemoveGroupMemberRequest) returns (RemoveGroupMemberResponse);

  // Organization Management
  // =======================

  // CreateOrganization creates new organization.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'organizations:create' permission
  // RATE LIMIT: 10/min per tenant
  rpc CreateOrganization(CreateOrganizationRequest) returns (CreateOrganizationResponse);

  // GetOrganization retrieves organization by ID.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'organizations:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetOrganization(GetOrganizationRequest) returns (GetOrganizationResponse);

  // UpdateOrganization updates organization.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'organizations:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdateOrganization(UpdateOrganizationRequest) returns (UpdateOrganizationResponse);

  // DeleteOrganization deletes organization.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'organizations:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeleteOrganization(DeleteOrganizationRequest) returns (DeleteOrganizationResponse);

  // ListOrganizations lists organizations.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'organizations:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListOrganizations(ListOrganizationsRequest) returns (ListOrganizationsResponse);

  // Search
  // ======

  // SearchIdentities searches across users, groups, organizations.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Requires 'identities:search' permission
  // RATE LIMIT: 100/min per user
  rpc SearchIdentities(SearchIdentitiesRequest) returns (SearchIdentitiesResponse);
}
