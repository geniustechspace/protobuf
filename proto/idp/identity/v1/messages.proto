// DOMAIN: Identity Provider - Identity Management Messages
// COMPLIANCE: SOC 2 CC6.1, GDPR Article 5, ISO 27001 A.9.2
// SECURITY: Authentication required, tenant isolation enforced
// PII: Contains user personal data

syntax = "proto3";

package geniustechspace.idp.identity.v1;

import "buf/validate/validate.proto";
import "core/common/v1/common.proto";
import "core/metadata/v1/metadata.proto";
import "google/protobuf/timestamp.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Identity.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/identity/v1;idpidentityv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.identity.v1";

// UserProfile represents user identity information.
// PII: Yes - contains personal data
message UserProfile {
  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string id = 1 [(buf.validate.field).string.min_len = 1];

  // Tenant ID. REQUIRED.
  string tenant_id = 2 [(buf.validate.field).string.min_len = 1];

  // Email. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  // VALIDATION: RFC 5322 email format
  string email = 3 [(buf.validate.field).string.email = true];

  // Email verified. REQUIRED.
  bool email_verified = 4;

  // Phone number. OPTIONAL.
  // PII: Yes - GDPR Article 4(1) personal identifier
  // VALIDATION: E.164 format
  string phone_number = 5 [(buf.validate.field).string.pattern = "^\\+[1-9]\\d{1,14}$"];

  // Phone verified. OPTIONAL.
  bool phone_verified = 6;

  // Given name. OPTIONAL.
  // PII: Yes - GDPR Article 4(1) personal data
  string given_name = 7;

  // Family name. OPTIONAL.
  // PII: Yes - GDPR Article 4(1) personal data
  string family_name = 8;

  // Display name. OPTIONAL.
  // PII: Possibly - if contains real name
  string display_name = 9;

  // Picture URL. OPTIONAL.
  // PII: Possibly - biometric data under GDPR Article 9
  string picture_url = 10;

  // Locale. OPTIONAL.
  // ISO 639-1 language code with optional ISO 3166-1 country code
  string locale = 11;

  // Timezone. OPTIONAL.
  // IANA timezone (e.g., "America/New_York")
  string timezone = 12;

  // Status. REQUIRED.
  UserStatus status = 13 [(buf.validate.field).enum.defined_only = true];

  // Metadata. OPTIONAL.
  core.metadata.v1.Metadata metadata = 14;
}

// UserStatus represents user account status.
enum UserStatus {
  USER_STATUS_UNSPECIFIED = 0;
  ACTIVE = 1; // Active account
  INACTIVE = 2; // Inactive but can be reactivated
  SUSPENDED = 3; // Temporarily suspended
  LOCKED = 4; // Locked due to security
  DELETED = 5; // Soft deleted
  PENDING_VERIFICATION = 6; // Awaiting email/phone verification
  reserved 7 to 20;
}

// GetUserProfileRequest retrieves user profile.
// AUTHENTICATION: Required
// AUTHORIZATION: Self or 'users:read' permission
message GetUserProfileRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];
}

// GetUserProfileResponse returns user profile.
message GetUserProfileResponse {
  // Profile. REQUIRED.
  UserProfile profile = 1;
}

// UpdateUserProfileRequest updates user profile.
// AUTHENTICATION: Required
// AUTHORIZATION: Self or 'users:update' permission
message UpdateUserProfileRequest {
  // Tenant ID. REQUIRED.
  string tenant_id = 1 [(buf.validate.field).string.min_len = 1];

  // User ID. REQUIRED.
  // PII: Yes - GDPR Article 4(1) personal identifier
  string user_id = 2 [(buf.validate.field).string.min_len = 1];

  // Given name. OPTIONAL.
  // PII: Yes - GDPR Article 4(1) personal data
  string given_name = 3;

  // Family name. OPTIONAL.
  // PII: Yes - GDPR Article 4(1) personal data
  string family_name = 4;

  // Display name. OPTIONAL.
  string display_name = 5;

  // Picture URL. OPTIONAL.
  string picture_url = 6;

  // Locale. OPTIONAL.
  string locale = 7;

  // Timezone. OPTIONAL.
  string timezone = 8;
}

// UpdateUserProfileResponse confirms profile update.
message UpdateUserProfileResponse {
  // Success. REQUIRED.
  bool success = 1;

  // Profile. OPTIONAL.
  // Updated profile.
  UserProfile profile = 2;
}
