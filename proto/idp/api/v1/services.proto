// DOMAIN: Identity Provider - Public Services
// COMPLIANCE: SOC 2, GDPR, ISO 27001
// SECURITY: All services require authentication unless specified
//
// ⚠️ DEPRECATED: This consolidated service file is deprecated.
// Use modular subdomain services instead:
// - proto/idp/identity/{user,group,organization,profile}/api/v1/service.proto
// - proto/idp/authn/{credential,session,mfa}/api/v1/service.proto
// - proto/idp/authz/{permission,role,policy}/api/v1/service.proto
// See proto/idp/api/v1/MIGRATION.md for migration guide.

syntax = "proto3";

package geniustechspace.idp.api.v1;

import "idp/api/v1/authn_api.proto";
import "idp/api/v1/authz_api.proto";
import "idp/api/v1/identity_api.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.Api.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/api/v1;idpapiv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.api.v1";

// =============================================================================
// IDENTITY SERVICE
// =============================================================================

// IdentityService manages users, profiles, groups, organizations.
// COMPLIANCE: GDPR Article 5, ISO 27001 A.9.2, SOC 2 CC6.1
// AUTHENTICATION: Required for all operations
// RATE LIMIT: Varies by operation (see individual RPCs)
service IdentityService {
  // User Management
  // ===============

  // CreateUser creates new user account.
  // AUTHORIZATION: Requires 'users:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);

  // GetUser retrieves user by ID.
  // AUTHORIZATION: Self or 'users:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetUser(GetUserRequest) returns (GetUserResponse);

  // UpdateUser updates user account.
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 20/min per user
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);

  // DeleteUser deletes user account (soft delete).
  // AUTHORIZATION: Requires 'users:delete' permission
  // COMPLIANCE: GDPR Right to Erasure (Article 17)
  // RATE LIMIT: 10/min per tenant
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);

  // ListUsers lists users with filtering.
  // AUTHORIZATION: Requires 'users:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);

  // Profile Management
  // ==================

  // GetUserProfile retrieves user profile.
  // AUTHORIZATION: Self or 'users:read' permission
  // RATE LIMIT: 100/min per user
  rpc GetUserProfile(GetUserProfileRequest) returns (GetUserProfileResponse);

  // UpdateUserProfile updates user profile.
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 20/min per user
  rpc UpdateUserProfile(UpdateUserProfileRequest) returns (UpdateUserProfileResponse);

  // Verification
  // ============

  // VerifyEmail initiates email verification flow.
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 5/hour per user
  rpc VerifyEmail(VerifyEmailRequest) returns (VerifyEmailResponse);

  // ConfirmEmailVerification confirms email with token.
  // AUTHENTICATION: Public (token-based)
  // RATE LIMIT: 10/hour per IP
  rpc ConfirmEmailVerification(ConfirmEmailVerificationRequest) returns (ConfirmEmailVerificationResponse);

  // VerifyPhone initiates phone verification flow.
  // AUTHORIZATION: Self or 'users:update' permission
  // RATE LIMIT: 5/hour per user
  rpc VerifyPhone(VerifyPhoneRequest) returns (VerifyPhoneResponse);

  // ConfirmPhoneVerification confirms phone with code.
  // AUTHENTICATION: Required
  // RATE LIMIT: 10/hour per user
  rpc ConfirmPhoneVerification(ConfirmPhoneVerificationRequest) returns (ConfirmPhoneVerificationResponse);

  // Group Management
  // ================

  // CreateGroup creates new group.
  // AUTHORIZATION: Requires 'groups:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreateGroup(CreateGroupRequest) returns (CreateGroupResponse);

  // GetGroup retrieves group by ID.
  // AUTHORIZATION: Requires 'groups:read' permission
  // RATE LIMIT: 100/min per tenant
  rpc GetGroup(GetGroupRequest) returns (GetGroupResponse);

  // UpdateGroup updates group.
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdateGroup(UpdateGroupRequest) returns (UpdateGroupResponse);

  // DeleteGroup deletes group.
  // AUTHORIZATION: Requires 'groups:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeleteGroup(DeleteGroupRequest) returns (DeleteGroupResponse);

  // AddGroupMember adds member to group.
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 50/min per tenant
  rpc AddGroupMember(AddGroupMemberRequest) returns (AddGroupMemberResponse);

  // RemoveGroupMember removes member from group.
  // AUTHORIZATION: Requires 'groups:update' permission
  // RATE LIMIT: 50/min per tenant
  rpc RemoveGroupMember(RemoveGroupMemberRequest) returns (RemoveGroupMemberResponse);

  // ListGroups lists groups with filtering.
  // AUTHORIZATION: Requires 'groups:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListGroups(ListGroupsRequest) returns (ListGroupsResponse);

  // Organization Management
  // =======================

  // CreateOrganization creates new organization.
  // AUTHORIZATION: Requires 'organizations:create' permission
  // RATE LIMIT: 10/min per tenant
  rpc CreateOrganization(CreateOrganizationRequest) returns (CreateOrganizationResponse);

  // GetOrganization retrieves organization by ID.
  // AUTHORIZATION: Requires 'organizations:read' permission
  // RATE LIMIT: 100/min per tenant
  rpc GetOrganization(GetOrganizationRequest) returns (GetOrganizationResponse);

  // UpdateOrganization updates organization.
  // AUTHORIZATION: Requires 'organizations:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdateOrganization(UpdateOrganizationRequest) returns (UpdateOrganizationResponse);

  // DeleteOrganization deletes organization.
  // AUTHORIZATION: Requires 'organizations:delete' permission
  // RATE LIMIT: 5/min per tenant
  rpc DeleteOrganization(DeleteOrganizationRequest) returns (DeleteOrganizationResponse);

  // ListOrganizations lists organizations with filtering.
  // AUTHORIZATION: Requires 'organizations:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListOrganizations(ListOrganizationsRequest) returns (ListOrganizationsResponse);

  // Search
  // ======

  // SearchIdentities searches across users, groups, organizations.
  // AUTHORIZATION: Requires 'identities:search' permission
  // RATE LIMIT: 50/min per tenant
  rpc SearchIdentities(SearchIdentitiesRequest) returns (SearchIdentitiesResponse);
}

// =============================================================================
// AUTHENTICATION SERVICE
// =============================================================================

// AuthenticationService handles authentication and session management.
// COMPLIANCE: SOC 2 CC6.1, NIST 800-63B, FIDO2, WebAuthn Level 2
// AUTHENTICATION: Public for initial auth, required for session management
// RATE LIMIT: Aggressive rate limiting on auth endpoints (see individual RPCs)
service AuthenticationService {
  // Authentication
  // ==============

  // Authenticate performs primary authentication.
  // AUTHENTICATION: Public (this is the entry point)
  // RATE LIMIT: 10/min per IP, 3 failures = lockout
  // COMPLIANCE: NIST 800-63B AAL1-AAL3
  rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);

  // VerifyMfa verifies MFA challenge.
  // AUTHENTICATION: Requires valid challenge ID
  // RATE LIMIT: 5/min per challenge
  // COMPLIANCE: NIST 800-63B AAL2-AAL3
  rpc VerifyMfa(VerifyMfaRequest) returns (VerifyMfaResponse);

  // Session Management
  // ==================

  // RefreshToken refreshes access token using refresh token.
  // AUTHENTICATION: Requires valid refresh token
  // RATE LIMIT: 100/hour per user
  rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);

  // ValidateToken validates access token.
  // AUTHENTICATION: Public (validation endpoint)
  // RATE LIMIT: 1000/min per tenant
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);

  // Logout ends user session.
  // AUTHENTICATION: Required
  // RATE LIMIT: 50/min per user
  rpc Logout(LogoutRequest) returns (LogoutResponse);

  // ListSessions lists active sessions for user.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'sessions:list' permission
  // RATE LIMIT: 20/min per user
  rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);

  // RevokeSession revokes specific session.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'sessions:revoke' permission
  // RATE LIMIT: 20/min per user
  rpc RevokeSession(RevokeSessionRequest) returns (RevokeSessionResponse);

  // Password Management
  // ===================

  // ChangePassword changes user password.
  // AUTHENTICATION: Required
  // AUTHORIZATION: Self or 'passwords:change' permission
  // RATE LIMIT: 5/hour per user
  rpc ChangePassword(ChangePasswordRequest) returns (ChangePasswordResponse);

  // ResetPassword initiates password reset flow.
  // AUTHENTICATION: Public
  // RATE LIMIT: 3/hour per email/username
  rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);

  // ConfirmPasswordReset confirms password reset with token.
  // AUTHENTICATION: Public (token-based)
  // RATE LIMIT: 5/hour per IP
  rpc ConfirmPasswordReset(ConfirmPasswordResetRequest) returns (ConfirmPasswordResetResponse);
}

// =============================================================================
// AUTHORIZATION SERVICE
// =============================================================================

// AuthorizationService handles authorization and access control.
// COMPLIANCE: SOC 2 CC6.2, ISO 27001 A.9.4
// AUTHENTICATION: Required for all operations
// RATE LIMIT: High throughput for permission checks (see individual RPCs)
service AuthorizationService {
  // Permission Checks
  // =================

  // CheckPermission checks single permission.
  // RATE LIMIT: 1000/min per tenant (critical path)
  rpc CheckPermission(CheckPermissionRequest) returns (CheckPermissionResponse);

  // BatchCheckPermissions checks multiple permissions in one call.
  // RATE LIMIT: 500/min per tenant
  rpc BatchCheckPermissions(BatchCheckPermissionsRequest) returns (BatchCheckPermissionsResponse);

  // Role Management
  // ===============

  // CreateRole creates new role.
  // AUTHORIZATION: Requires 'roles:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse);

  // GetRole retrieves role by ID.
  // AUTHORIZATION: Requires 'roles:read' permission
  // RATE LIMIT: 100/min per tenant
  rpc GetRole(GetRoleRequest) returns (GetRoleResponse);

  // UpdateRole updates role.
  // AUTHORIZATION: Requires 'roles:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse);

  // DeleteRole deletes role.
  // AUTHORIZATION: Requires 'roles:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeleteRole(DeleteRoleRequest) returns (DeleteRoleResponse);

  // ListRoles lists roles.
  // AUTHORIZATION: Requires 'roles:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);

  // Role Assignments
  // ================

  // AssignRole assigns role to subject (user/group).
  // AUTHORIZATION: Requires 'roles:assign' permission
  // RATE LIMIT: 50/min per tenant
  rpc AssignRole(AssignRoleRequest) returns (AssignRoleResponse);

  // RevokeRole revokes role assignment.
  // AUTHORIZATION: Requires 'roles:revoke' permission
  // RATE LIMIT: 50/min per tenant
  rpc RevokeRole(RevokeRoleRequest) returns (RevokeRoleResponse);

  // ListRoleAssignments lists role assignments.
  // AUTHORIZATION: Requires 'roles:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListRoleAssignments(ListRoleAssignmentsRequest) returns (ListRoleAssignmentsResponse);

  // Policy Management
  // =================

  // CreatePolicy creates authorization policy.
  // AUTHORIZATION: Requires 'policies:create' permission
  // RATE LIMIT: 20/min per tenant
  rpc CreatePolicy(CreatePolicyRequest) returns (CreatePolicyResponse);

  // GetPolicy retrieves policy by ID.
  // AUTHORIZATION: Requires 'policies:read' permission
  // RATE LIMIT: 100/min per tenant
  rpc GetPolicy(GetPolicyRequest) returns (GetPolicyResponse);

  // UpdatePolicy updates policy.
  // AUTHORIZATION: Requires 'policies:update' permission
  // RATE LIMIT: 20/min per tenant
  rpc UpdatePolicy(UpdatePolicyRequest) returns (UpdatePolicyResponse);

  // DeletePolicy deletes policy.
  // AUTHORIZATION: Requires 'policies:delete' permission
  // RATE LIMIT: 10/min per tenant
  rpc DeletePolicy(DeletePolicyRequest) returns (DeletePolicyResponse);

  // ListPolicies lists policies.
  // AUTHORIZATION: Requires 'policies:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListPolicies(ListPoliciesRequest) returns (ListPoliciesResponse);

  // Permission Queries
  // ==================

  // ListPermissions lists available permissions.
  // AUTHORIZATION: Requires 'permissions:list' permission
  // RATE LIMIT: 50/min per tenant
  rpc ListPermissions(ListPermissionsRequest) returns (ListPermissionsResponse);

  // GetUserPermissions gets effective permissions for user.
  // AUTHORIZATION: Self or 'permissions:read' permission
  // RATE LIMIT: 100/min per tenant
  rpc GetUserPermissions(GetUserPermissionsRequest) returns (GetUserPermissionsResponse);
}
