// DOMAIN: Contact - Email Addresses
// COMPLIANCE: GDPR Article 5, SOC 2 CC6.1
// SECURITY: PII data - encryption at rest required
// PII: Yes - email address is personal identifier

syntax = "proto3";

package geniustechspace.contact.email.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/geniustechspace/protobuf/gen/go/contact/email/v1;contactemailv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.contact.email.v1";

// EmailLabel - standard email address classifications.
enum EmailLabel {
  UNSPECIFIED = 0; // Default value, not set
  PERSONAL = 1; // Personal email address
  WORK = 2; // Work/business email
  SCHOOL = 3; // Educational institution email
  OTHER = 4; // Other email types
  CUSTOM = 5; // Custom label (use custom_label field)
}

// UserEmail - user's email addresses.
// PII: Yes - GDPR Article 4(1) personal identifier.
// MULTI-RECORD: Users can have multiple email addresses (personal, work, school).
// USAGE: Authentication, notifications, password recovery, communication.
message UserEmail {
  // Email ID. Primary key.
  string email_id = 1 [(buf.validate.field).string.max_len = 512];

  // User ID. Foreign key to identity system.
  string user_id = 2 [(buf.validate.field).string.max_len = 512];

  // Hierarchical tenant path for nested multi-tenancy.
  // Examples: "acme-corp", "acme-corp/customer-1", "acme-corp/customer-1/sub-org"
  // ISOLATION: Supports unlimited nesting levels for complex B2B2B... scenarios.
  string tenant_path = 3 [(buf.validate.field).string.max_len = 512];

  // Email address classification label.
  // USAGE: Determines email purpose and routing behavior.
  EmailLabel label = 4 [(buf.validate.field).enum.defined_only = true];

  // Email address in RFC 5322 format.
  // VALIDATION: Must be valid email format.
  // NORMALIZATION: Stored in lowercase for consistency.
  string email = 5 [(buf.validate.field).string = {
    min_len: 3
    max_len: 254
    email: true
  }];

  // Domain extracted from email address (e.g., "example.com").
  string domain = 6 [(buf.validate.field).string.max_len = 253];

  // Custom label text. REQUIRED when label = CUSTOM.
  // Examples: "Newsletter Subscriptions", "Alumni Email", "Business Inquiries"
  string custom_label = 7 [(buf.validate.field).string.max_len = 100];

  // Optional tags for additional categorization and metadata.
  // Examples: ["verified", "primary-contact", "newsletter", "marketing-consent", "support"]
  // VALIDATION: Lowercase alphanumeric with hyphens only.
  repeated string tags = 8 [(buf.validate.field).repeated = {
    max_items: 20
    items: {
      string: {
        min_len: 1
        max_len: 50
        pattern: "^[a-z0-9-]+$"
      }
    }
  }];

  // Primary email flag (one primary per label per user).
  bool is_primary = 9;

  reserved 10 to 19;

  // Email verification timestamp.
  google.protobuf.Timestamp verified_at = 20;

  // Created timestamp.
  google.protobuf.Timestamp created_at = 21 [(buf.validate.field).required = true];

  // Last updated timestamp.
  google.protobuf.Timestamp updated_at = 22;

  // Deletion timestamp (soft delete).
  google.protobuf.Timestamp deleted_at = 23;

  reserved 24 to 29;

  // Optimistic locking version.
  int64 version = 30 [(buf.validate.field).int64.gte = 1];

  reserved 31 to 39;
}
