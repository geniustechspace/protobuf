// Authentication Domain Events - Version 1
//
// Comprehensive authentication and security events for audit logging,
// security monitoring, fraud detection, and compliance reporting.
//
// COMPLIANCE: SOC 2 CC6.8 (Security monitoring), ISO 27001 A.12.4.1 (Event logging)
//             NIST 800-63B (Authentication logging), GDPR Article 30 (Records of processing)
// SECURITY: Contains IP addresses and session data for security analysis
// USAGE: Publish to event bus, wrap in core.v1.BaseEvent for event sourcing

syntax = "proto3";

package auth.v1;

import "google/protobuf/timestamp.proto";
import "auth/v1/enums.proto";
import "proto/datastructure/v1/device/enums.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Auth.V1";
option go_package = "github.com/geniustechspace/protobuf/gen/go/auth/v1;authv1";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.auth.v1";

// ============================================================================
// AUTHENTICATION EVENTS
// ============================================================================

// UserAuthenticatedEvent published on successful authentication
// COMPLIANCE: SOC 2 CC6.8 (Access logging), ISO 27001 A.12.4.1
message UserAuthenticatedEvent {
  reserved 10 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string session_id = 3;
  google.protobuf.Timestamp authenticated_at = 4;
  string ip_address = 5;
  string user_agent = 6;
  string device_id = 7;
  AuthenticationMethod method = 8;
  repeated AuthenticationFactor factors = 9;

  // Geolocation
  string country = 31;
  string city = 32;

  // Risk assessment
  RiskLevel risk_level = 33;
  int32 risk_score = 34;
}

// AuthenticationFailedEvent triggered on failed authentication attempt
// COMPLIANCE: SOC 2 CC6.8, detect brute force attacks
message AuthenticationFailedEvent {
  reserved 10 to 30;

  string user_id = 1;  // May be empty if user not found
  string tenant_id = 2;
  string identifier = 3;  // Email, username, or phone attempted
  string reason = 4;
  google.protobuf.Timestamp failed_at = 5;
  string ip_address = 6;
  string user_agent = 7;
  AuthenticationMethod attempted_method = 8;
  int32 failure_count = 9;  // Consecutive failures

  // Geolocation
  string country = 31;
  string city = 32;
}

// AuthenticationChallengeIssuedEvent when additional verification required
message AuthenticationChallengeIssuedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string auth_id = 3;
  AuthenticationMethod challenge_method = 4;
  google.protobuf.Timestamp issued_at = 5;
  string ip_address = 6;
  RiskLevel risk_level = 7;
}

// ============================================================================
// SESSION EVENTS
// ============================================================================

// SessionCreatedEvent when new session is created
message SessionCreatedEvent {
  reserved 10 to 30;

  string session_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  SessionType session_type = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp expires_at = 6;
  string ip_address = 7;
  string user_agent = 8;
  string device_id = 9;

  // Geolocation
  string country = 31;
  string city = 32;
}

// SessionExtendedEvent when session expiration is extended
message SessionExtendedEvent {
  reserved 7 to 30;

  string session_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp extended_at = 4;
  google.protobuf.Timestamp new_expires_at = 5;
  int64 extended_by_seconds = 6;
}

// SessionRevokedEvent when session is manually revoked
message SessionRevokedEvent {
  reserved 7 to 30;

  string session_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp revoked_at = 4;
  string revoked_by = 5;  // User or admin who revoked
  string reason = 6;
}

// SessionExpiredEvent when session naturally expires
message SessionExpiredEvent {
  reserved 6 to 30;

  string session_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp expired_at = 4;
  SessionType session_type = 5;
}

// UserLoggedOutEvent when user explicitly logs out
message UserLoggedOutEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string session_id = 3;
  google.protobuf.Timestamp logged_out_at = 4;
  bool all_sessions_revoked = 5;
  string ip_address = 6;
}

// ============================================================================
// PASSWORD EVENTS
// ============================================================================

// PasswordResetRequestedEvent when password reset is requested
message PasswordResetRequestedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string email = 3;
  google.protobuf.Timestamp requested_at = 4;
  string ip_address = 5;
  string reset_token_id = 6;  // Token identifier (not the token itself)
}

// PasswordResetCompletedEvent when password reset is completed
message PasswordResetCompletedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp completed_at = 3;
  string ip_address = 4;
  string device_id = 5;
  bool sessions_invalidated = 6;
}

// PasswordChangedEvent when password is changed by authenticated user
message PasswordChangedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp changed_at = 3;
  PasswordChangeReason reason = 4;
  string changed_by = 5;  // User or admin ID
  bool sessions_invalidated = 6;
}

// PasswordCompromisedEvent when password found in breach database
message PasswordCompromisedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp detected_at = 3;
  string breach_source = 4;
  bool force_reset = 5;
}

// ============================================================================
// TOKEN EVENTS
// ============================================================================

// TokenIssuedEvent when tokens are issued
message TokenIssuedEvent {
  reserved 9 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string token_id = 3;  // JTI or token identifier
  TokenType token_type = 4;
  google.protobuf.Timestamp issued_at = 5;
  google.protobuf.Timestamp expires_at = 6;
  repeated string scopes = 7;
  string client_id = 8;  // OAuth2 client ID
}

// TokenRefreshedEvent when token is refreshed
message TokenRefreshedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string session_id = 3;
  string old_token_id = 4;
  string new_token_id = 5;
  google.protobuf.Timestamp refreshed_at = 6;
  string ip_address = 7;
}

// TokenRevokedEvent when token is revoked
message TokenRevokedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string token_id = 3;
  TokenType token_type = 4;
  google.protobuf.Timestamp revoked_at = 5;
  string revoked_by = 6;  // User or admin who revoked
}

// TokenExpiredEvent when token expires
message TokenExpiredEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string token_id = 3;
  TokenType token_type = 4;
  google.protobuf.Timestamp expired_at = 5;
}

// TokenIntrospectedEvent when token is introspected
message TokenIntrospectedEvent {
  reserved 7 to 30;

  string token_id = 1;
  string client_id = 2;
  bool active = 3;
  google.protobuf.Timestamp introspected_at = 4;
  string ip_address = 5;
  string user_agent = 6;
}

// ============================================================================
// MFA EVENTS
// ============================================================================

// MFAEnrolledEvent when MFA method is enrolled
message MFAEnrolledEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  MultiFactorType mfa_type = 3;
  string method_id = 4;
  google.protobuf.Timestamp enrolled_at = 5;
  string device_id = 6;
}

// MFAVerifiedEvent when MFA challenge is successfully verified
message MFAVerifiedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  MultiFactorType mfa_type = 3;
  string method_id = 4;
  google.protobuf.Timestamp verified_at = 5;
  string ip_address = 6;
  string device_id = 7;
}

// MFAFailedEvent when MFA verification fails
message MFAFailedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  MultiFactorType mfa_type = 3;
  string method_id = 4;
  string reason = 5;
  google.protobuf.Timestamp failed_at = 6;
  int32 failure_count = 7;
}

// MFADisabledEvent when MFA method is disabled
message MFADisabledEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  MultiFactorType mfa_type = 3;
  string method_id = 4;
  google.protobuf.Timestamp disabled_at = 5;
  string disabled_by = 6;  // User or admin ID
}

// BackupCodesGeneratedEvent when backup codes are generated
message BackupCodesGeneratedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  int32 codes_count = 3;
  google.protobuf.Timestamp generated_at = 4;
  string generated_by = 5;  // User or admin ID
}

// BackupCodeUsedEvent when backup code is used
message BackupCodeUsedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp used_at = 3;
  int32 remaining_codes = 4;
  string ip_address = 5;
}

// ============================================================================
// WEBAUTHN EVENTS
// ============================================================================

// WebAuthnCredentialRegisteredEvent when WebAuthn credential is registered
message WebAuthnCredentialRegisteredEvent {
  reserved 9 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string credential_id = 3;
  string credential_name = 4;
  google.protobuf.Timestamp registered_at = 5;
  string aaguid = 6;  // Authenticator AAGUID
  repeated string transports = 7;
  bool backup_eligible = 8;
}

// WebAuthnCredentialUsedEvent when WebAuthn credential is used for authentication
message WebAuthnCredentialUsedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string credential_id = 3;
  google.protobuf.Timestamp used_at = 4;
  int64 sign_count = 5;
  string ip_address = 6;
  string user_agent = 7;
}

// WebAuthnCredentialDeletedEvent when WebAuthn credential is deleted
message WebAuthnCredentialDeletedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string credential_id = 3;
  google.protobuf.Timestamp deleted_at = 4;
  string deleted_by = 5;  // User or admin ID
}

// ============================================================================
// DEVICE TRUST EVENTS
// ============================================================================

// DeviceTrustedEvent when device is marked as trusted
message DeviceTrustedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string device_id = 3;
  geniustechspace.datastructure.v1.device.DeviceTrustLevel trust_level = 4;
  google.protobuf.Timestamp trusted_at = 5;
  string device_name = 6;
}

// DeviceRemovedEvent when trusted device is removed
message DeviceRemovedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string device_id = 3;
  google.protobuf.Timestamp removed_at = 4;
  string removed_by = 5;  // User or admin ID
}

// DeviceCompromisedEvent when device is suspected to be compromised
message DeviceCompromisedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string device_id = 3;
  string reason = 4;
  google.protobuf.Timestamp detected_at = 5;
  repeated string indicators = 6;  // Compromise indicators
}

// ============================================================================
// SECURITY & RISK EVENTS
// ============================================================================

// SuspiciousActivityDetectedEvent when anomalous behavior is detected
message SuspiciousActivityDetectedEvent {
  reserved 10 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string activity_type = 3;
  string description = 4;
  RiskLevel risk_level = 5;
  int32 risk_score = 6;
  google.protobuf.Timestamp detected_at = 7;
  string ip_address = 8;
  repeated string risk_factors = 9;
}

// AccountLockedEvent when account is locked due to security policy
message AccountLockedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string reason = 3;
  google.protobuf.Timestamp locked_at = 4;
  string locked_by = 5;  // System or admin ID
  google.protobuf.Timestamp unlock_at = 6;  // Auto-unlock time, if applicable
}

// AccountUnlockedEvent when locked account is unlocked
message AccountUnlockedEvent {
  reserved 6 to 30;

  string user_id = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp unlocked_at = 3;
  string unlocked_by = 4;  // Admin or user ID
  string reason = 5;
}

// BruteForceDetectedEvent when brute force attack is detected
message BruteForceDetectedEvent {
  reserved 8 to 30;

  string target_user_id = 1;
  string tenant_id = 2;
  string ip_address = 3;
  int32 attempt_count = 4;
  google.protobuf.Timestamp detected_at = 5;
  google.protobuf.Timestamp first_attempt_at = 6;
  bool blocked = 7;
}

// RateLimitExceededEvent when rate limit is exceeded
message RateLimitExceededEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string endpoint = 3;
  int32 limit = 4;
  int32 window_seconds = 5;
  google.protobuf.Timestamp exceeded_at = 6;
  string ip_address = 7;
}

// ============================================================================
// OAUTH2 & SOCIAL LOGIN EVENTS
// ============================================================================

// OAuth2ClientRegisteredEvent when OAuth2 client is registered
message OAuth2ClientRegisteredEvent {
  reserved 6 to 30;

  string client_id = 1;
  string client_name = 2;
  string tenant_id = 3;
  repeated OAuth2GrantType grant_types = 4;
  google.protobuf.Timestamp registered_at = 5;
}

// OAuth2AuthorizationGrantedEvent when authorization is granted
message OAuth2AuthorizationGrantedEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string client_id = 3;
  repeated string scopes = 4;
  string authorization_code = 5;
  google.protobuf.Timestamp granted_at = 6;
  string ip_address = 7;
}

// SocialAccountLinkedEvent when social account is linked
message SocialAccountLinkedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  SocialProvider provider = 3;
  string provider_user_id = 4;
  string provider_email = 5;
  google.protobuf.Timestamp linked_at = 6;
}

// SocialAccountUnlinkedEvent when social account is unlinked
message SocialAccountUnlinkedEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  SocialProvider provider = 3;
  string provider_user_id = 4;
  google.protobuf.Timestamp unlinked_at = 5;
  string unlinked_by = 6;  // User or admin ID
}

// SocialLoginEvent when user logs in via social provider
message SocialLoginEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  SocialProvider provider = 3;
  string provider_user_id = 4;
  google.protobuf.Timestamp logged_in_at = 5;
  string ip_address = 6;
}

// ============================================================================
// API KEY EVENTS
// ============================================================================

// ApiKeyCreatedEvent when API key is created
message ApiKeyCreatedEvent {
  reserved 7 to 30;

  string key_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  string key_name = 4;
  repeated string scopes = 5;
  google.protobuf.Timestamp created_at = 6;
}

// ApiKeyUsedEvent when API key is used
message ApiKeyUsedEvent {
  reserved 7 to 30;

  string key_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp used_at = 4;
  string endpoint = 5;
  string ip_address = 6;
}

// ApiKeyRevokedEvent when API key is revoked
message ApiKeyRevokedEvent {
  reserved 6 to 30;

  string key_id = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp revoked_at = 4;
  string revoked_by = 5;  // User or admin ID
}

// ============================================================================
// SAML EVENTS
// ============================================================================

// SAMLAuthenticationEvent when user authenticates via SAML
message SAMLAuthenticationEvent {
  reserved 8 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string idp_entity_id = 3;
  string name_id = 4;
  string session_index = 5;
  google.protobuf.Timestamp authenticated_at = 6;
  string ip_address = 7;
}

// SAMLLogoutEvent when SAML logout occurs
message SAMLLogoutEvent {
  reserved 7 to 30;

  string user_id = 1;
  string tenant_id = 2;
  string idp_entity_id = 3;
  string session_index = 4;
  google.protobuf.Timestamp logged_out_at = 5;
  bool initiated_by_sp = 6;  // Service Provider initiated
}
