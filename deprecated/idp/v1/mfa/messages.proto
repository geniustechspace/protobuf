// IDP MFA Messages - Version 1
// Multi-factor authentication enrollment and management messages
//
// COMPLIANCE:
//   - NIST 800-63B: Authenticator assurance levels
//   - PSD2: Strong Customer Authentication (SCA)
//   - OWASP: MFA best practices
//   - SOC 2: Multi-factor authentication controls

syntax = "proto3";

package geniustechspace.idp.v1.mfa;

import "buf/validate/validate.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.V1.Mfa";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/v1/mfa;mfa";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.v1.mfa";

// ==== TOTP ENROLLMENT (Authenticator App) ====

message BeginTOTPEnrollmentRequest {
  reserved 4 to 30;
  
  string user_id = 1;
  string tenant_id = 2;
  string issuer = 3;                          // App/company name
}

message BeginTOTPEnrollmentResponse {
  reserved 5 to 30;
  
  string enrollment_id = 1;                   // Enrollment session ID
  string secret = 2;                          // Base32 secret for manual entry
  string qr_code_uri = 3;                     // otpauth:// URI for QR code
  repeated string backup_codes = 4;           // Recovery codes
}

message ConfirmTOTPEnrollmentRequest {
  reserved 4 to 30;
  
  string enrollment_id = 1;
  string tenant_id = 2;
  string code = 3;                            // 6-digit code from app
}

message ConfirmTOTPEnrollmentResponse {
  reserved 3 to 30;
  
  bool success = 1;
  string message = 2;
}

// ==== SMS/EMAIL ENROLLMENT ====

message BeginSMSEnrollmentRequest {
  reserved 4 to 30;
  
  string user_id = 1;
  string tenant_id = 2;
  string phone_number = 3;                    // E.164 format (+1234567890)
}

message BeginSMSEnrollmentResponse {
  reserved 3 to 30;
  
  string enrollment_id = 1;
  string message = 2;
}

message ConfirmSMSEnrollmentRequest {
  reserved 4 to 30;
  
  string enrollment_id = 1;
  string tenant_id = 2;
  string code = 3;                            // 6-digit code
}

message ConfirmSMSEnrollmentResponse {
  reserved 3 to 30;
  
  bool success = 1;
  string message = 2;
}

message BeginEmailEnrollmentRequest {
  reserved 4 to 30;
  
  string user_id = 1;
  string tenant_id = 2;
  string email = 3;
}

message BeginEmailEnrollmentResponse {
  reserved 3 to 30;
  
  string enrollment_id = 1;
  string message = 2;
}

message ConfirmEmailEnrollmentRequest {
  reserved 4 to 30;
  
  string enrollment_id = 1;
  string tenant_id = 2;
  string code = 3;                            // 6-digit code
}

message ConfirmEmailEnrollmentResponse {
  reserved 3 to 30;
  
  bool success = 1;
  string message = 2;
}

// ==== MFA FACTOR MANAGEMENT ====

message MFAFactor {
  reserved 10 to 30;
  
  string factor_id = 1;
  string type = 2;                            // "totp", "sms", "email", "webauthn"
  string display_name = 3;                    // "Authenticator App", "Phone ****1234"
  bool is_primary = 4;
  bool is_verified = 5;
  int64 created_at = 6;
  int64 last_used_at = 7;
}

message ListMFAFactorsRequest {
  reserved 3 to 30;
  
  string user_id = 1;
  string tenant_id = 2;
}

message ListMFAFactorsResponse {
  reserved 2 to 30;
  
  repeated MFAFactor factors = 1;
}

message RemoveMFAFactorRequest {
  reserved 4 to 30;
  
  string factor_id = 1;
  string user_id = 2;
  string tenant_id = 3;
}

message RemoveMFAFactorResponse {
  reserved 2 to 30;
  
  bool success = 1;
}

message SetPrimaryMFAFactorRequest {
  reserved 4 to 30;
  
  string factor_id = 1;
  string user_id = 2;
  string tenant_id = 3;
}

message SetPrimaryMFAFactorResponse {
  reserved 2 to 30;
  
  bool success = 1;
}

// ==== BACKUP CODES ====

message GenerateBackupCodesRequest {
  reserved 4 to 30;
  
  string user_id = 1;
  string tenant_id = 2;
  int32 count = 3;                            // Number of codes (typically 10)
}

message GenerateBackupCodesResponse {
  reserved 3 to 30;
  
  repeated string codes = 1;                  // List of backup codes
  string message = 2;
}
