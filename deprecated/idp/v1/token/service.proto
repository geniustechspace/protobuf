// IDP Token Service - Version 1
// Token lifecycle management (refresh, revoke, introspect)
//
// COMPLIANCE:
//   - OAuth 2.0 (RFC 6749): Token management
//   - RFC 7662: Token Introspection
//   - RFC 7009: Token Revocation
//   - OWASP: Token security best practices
//
// SECURITY:
//   - Short-lived access tokens (15 min default)
//   - Refresh token rotation on use
//   - Token binding to device/client context
//   - Immediate revocation support
//   - Audit logging for all operations
//
// RATE LIMITS:
//   - RefreshToken: 10/min per refresh token
//   - IntrospectToken: 100/min per client
//   - RevokeToken: 20/min per user
//   - ListTokens: 10/min per user

syntax = "proto3";

package geniustechspace.idp.v1.token;

import "proto/idp/v1/token/messages.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.V1.Token";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/v1/token;token";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.v1.token";

// TokenService handles OAuth 2.0 token lifecycle
//
// RESPONSIBILITY: Token refresh, revocation, introspection, listing
//
// ARCHITECTURE:
//   - Stateless operations (tokens are self-contained or cached)
//   - Idempotent revocation (repeated revoke = success)
//   - Atomic operations (token rotation on refresh)
service TokenService {
  // RefreshToken: Exchanges refresh token for new access token
  //
  // Behavior:
  //   - Validates refresh token (not expired/revoked)
  //   - Optionally rotates refresh token (recommended)
  //   - Returns new access token (+ optional new refresh token)
  //   - May downscope (if scopes requested)
  //
  // Rate limit: 10/min per refresh token
  // Auth required: Valid refresh token
  rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);
  
  // RevokeToken: Revokes a specific token
  //
  // Revokes access token, refresh token, or ID token.
  // Idempotent: Revoking already-revoked token succeeds.
  //
  // Rate limit: 20/min per user
  // Auth required: Yes (user/client token)
  rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);
  
  // RevokeAllTokens: Bulk token revocation
  //
  // Use cases:
  //   - Security incident (revoke all user tokens)
  //   - Device lost (revoke all tokens for device)
  //   - Session cleanup (revoke tokens for session)
  //   - Sign out everywhere
  //
  // Filters: tenant, user, session, device, client, network, geo
  //
  // Rate limit: 5/min per user
  // Auth required: Yes (user token or admin token)
  rpc RevokeAllTokens(RevokeAllTokensRequest) returns (RevokeAllTokensResponse);
  
  // ListTokens: Retrieves active tokens for user
  //
  // Useful for "active sessions" view in user settings.
  // Returns token metadata (no actual token values).
  //
  // Filters: token type, status, device, client, etc.
  //
  // Rate limit: 10/min per user
  // Auth required: Yes (user token)
  rpc ListTokens(ListTokensRequest) returns (ListTokensResponse);
  
  // IntrospectToken: Validates and returns token metadata
  //
  // RFC 7662 compliant token introspection.
  // Used by resource servers to validate bearer tokens.
  //
  // Returns: Active status, expiration, scopes, subject, etc.
  //
  // Rate limit: 100/min per client
  // Auth required: Yes (client credentials or privileged token)
  rpc IntrospectToken(IntrospectTokenRequest) returns (IntrospectTokenResponse);
}
