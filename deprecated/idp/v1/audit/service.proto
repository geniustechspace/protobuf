// IDP Audit Service - Version 1
// Compliance audit logging and querying service
//
// COMPLIANCE:
//   - SOC 2 Type II: Comprehensive audit trail
//   - PCI DSS 10.2: Audit log requirements
//   - HIPAA 164.312(b): Audit controls
//   - ISO 27001: Information security audit
//   - GDPR Article 30: Records of processing activities
//
// SECURITY:
//   - Immutable logs (append-only)
//   - Tamper detection (cryptographic hashing)
//   - Retention enforcement (13 months minimum)
//   - Access controls (admin/auditor roles only)
//   - PII protection (encryption at rest)
//
// RATE LIMITS:
//   - LogAuditEvent: 1000/min per service (internal)
//   - QueryAuditEvents: 10/min per user (expensive query)
//   - GetAuditEvent: 100/min per user

syntax = "proto3";

package geniustechspace.idp.v1.audit;

import "proto/idp/v1/audit/messages.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.V1.Audit";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/v1/audit;audit";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.v1.audit";

// AuditService handles compliance audit logging
//
// RESPONSIBILITY: Audit event creation, querying, compliance reporting
//
// ARCHITECTURE:
//   - Append-only storage (immutable)
//   - Time-series optimized (query by time range)
//   - Multi-tenant isolated (tenant_id filter mandatory)
//   - Async logging (non-blocking for performance)
//
// EVENT CATEGORIES:
//   - AUTHENTICATION: Login, logout, MFA
//   - SESSION: Session create, expire, revoke
//   - TOKEN: Token issue, refresh, revoke
//   - ACCOUNT: Create, update, delete, lock
//   - SECURITY: Policy change, risk assessment
//   - ACCESS_CONTROL: Permission grant/revoke
//   - DATA_ACCESS: PII access, export
//   - COMPLIANCE: GDPR request, data deletion
//   - SYSTEM: Service start/stop, config change
//   - ERROR: Authentication failures, security violations
service AuditService {
  // LogAuditEvent: Creates audit log entry
  //
  // Called internally by other IDP services.
  // Should be non-blocking (async queue recommended).
  //
  // Required fields:
  //   - tenant_id, event_category, event_type
  //   - actor (user/service performing action)
  //   - timestamp, action
  //
  // Rate limit: 1000/min per service (internal high throughput)
  // Auth required: Service account (internal API)
  rpc LogAuditEvent(AuditEvent) returns (LogAuditEventResponse);
  
  // QueryAuditEvents: Searches audit logs
  //
  // Advanced filtering:
  //   - Time range (required)
  //   - Categories, event types
  //   - Actor (user/service)
  //   - Resource (user_id, session_id, etc.)
  //   - Severity levels
  //   - Result status (success/failure)
  //
  // Pagination supported (large result sets).
  //
  // Rate limit: 10/min per user (expensive query)
  // Auth required: Admin/Auditor role
  rpc QueryAuditEvents(AuditEventQuery) returns (AuditEventQueryResponse);
  
  // GetAuditEvent: Retrieves single audit event by ID
  //
  // Useful for drill-down from query results.
  //
  // Rate limit: 100/min per user
  // Auth required: Admin/Auditor role
  rpc GetAuditEvent(GetAuditEventRequest) returns (AuditEvent);
}

// ========== Request/Response Messages ==========

message LogAuditEventResponse {
  bool success = 1;
  string event_id = 2;
}

message GetAuditEventRequest {
  string tenant_id = 1;
  string event_id = 2;
}
