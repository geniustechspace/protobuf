// IDP Password Service - Version 1
// Password management (reset, change, validation)
//
// COMPLIANCE:
//   - NIST 800-63B: Password requirements and policies
//   - OWASP: Password storage and reset best practices
//   - PCI DSS: Password change enforcement
//   - SOC 2: Password policy audit
//
// SECURITY:
//   - Bcrypt/Argon2 hashing (never plain text)
//   - Password strength validation
//   - Breach detection (HaveIBeenPwned integration)
//   - Rate limiting on reset (prevent enumeration)
//   - Secure reset tokens (short-lived, single-use)
//
// RATE LIMITS:
//   - ResetPassword: 3/hour per email (prevent enumeration)
//   - ConfirmPasswordReset: 5/hour per token
//   - ChangePassword: 10/hour per user

syntax = "proto3";

package geniustechspace.idp.v1.password;

import "proto/idp/v1/password/messages.proto";

option csharp_namespace = "GeniusTechSpace.Protobuf.Idp.V1.Password";
option go_package = "github.com/geniustechspace/protobuf/gen/go/idp/v1/password;password";
option java_multiple_files = true;
option java_package = "com.geniustechspace.protobuf.idp.v1.password";

// PasswordService handles password lifecycle
//
// RESPONSIBILITY: Password reset, change, strength validation
//
// ARCHITECTURE:
//   - Secure by default (strong hashing, breach detection)
//   - Two-step reset (request → email → confirm)
//   - Old password required for change (except admin override)
service PasswordService {
  // ResetPassword: Initiates password reset flow
  //
  // Sends reset email with time-limited token.
  // Returns success even if email not found (prevent enumeration).
  //
  // Rate limit: 3/hour per email (strict to prevent abuse)
  // Auth required: No
  rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);
  
  // ConfirmPasswordReset: Completes password reset
  //
  // Validates reset token and sets new password.
  // Token is single-use and expires in 1 hour.
  //
  // Validates:
  //   - Token valid and not expired
  //   - Password meets strength requirements
  //   - Password not breached (HaveIBeenPwned)
  //
  // Rate limit: 5/hour per token
  // Auth required: No (token-based)
  rpc ConfirmPasswordReset(ConfirmPasswordResetRequest) returns (ConfirmPasswordResetResponse);
  
  // ChangePassword: Changes password for authenticated user
  //
  // Requires old password (proof of identity).
  // Admin override: Can change without old password (audit logged).
  //
  // Actions:
  //   - Validate old password
  //   - Check new password strength
  //   - Hash and store new password
  //   - Optionally revoke all tokens (force re-auth)
  //
  // Rate limit: 10/hour per user
  // Auth required: Yes (user token)
  rpc ChangePassword(ChangePasswordRequest) returns (ChangePasswordResponse);
}
